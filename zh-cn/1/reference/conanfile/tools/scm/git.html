<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Git &mdash; conan 1.65.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/conan.css?v=f9087e22" />

  
    <link rel="shortcut icon" href="../../../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/reference/conanfile/tools/scm/git.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=b1fa76c8"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/translations.js?v=beaddf03"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" />
    <link rel="next" title="conan_version" href="other.html" />
    <link rel="prev" title="conan.tools.scm" href="../scm.html" />


 



</script>
<script type="text/javascript" src="../../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html">
            
              <img src="../../../../_static/conan-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../conan_v2.html">Conan migration guide to 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../training_courses.html">Training Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../creating_packages.html">Creating Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../uploading_packages.html">Uploading Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developing_packages.html">Developing packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mastering.html">Mastering Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extending.html">Extending Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../howtos.html">Howtos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../reference.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../commands.html">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../conanfile_txt.html">conanfile.txt</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../conanfile.html">conanfile.py</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../attributes.html">Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../methods.html">Methods</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../tools.html">tools</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../cmake.html">conan.tools.cmake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../gnu.html">conan.tools.gnu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../google.html">conan.tools.google</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apple.html">conan.tools.apple</a></li>
<li class="toctree-l4"><a class="reference internal" href="../meson.html">conan.tools.meson</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel.html">conan.tools.intel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../microsoft.html">conan.tools.microsoft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../qbs.html">conan.tools.qbs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../env.html">conan.tools.env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../system.html">conan.tools.system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../files.html">conan.tools.files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../layout.html">conan.tools.layout</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../scm.html">conan.tools.scm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build.html">conan.tools.build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../android.html">conan.tools.android</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scons.html">conan.tools.scons</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dependencies.html">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../other.html">Python requires</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../other.html#output-and-running">Output and Running</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../generators.html">Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html">Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../build_helpers.html">Build helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_files.html">Configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../env_vars.html">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hooks.html">Hooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div class="admonition warning wy-text-center" style="position:sticky;top:0;background: #fcfcfc;padding: inherit;z-index:1" id="conan-banners">
            
            <div style="border: 2px solid #eb8484;background-color: #ffcaca;padding: 3px;margin-bottom: 5px">
              <p>This document is for a <b>"1.X" legacy</b> Conan version, <b>which is no longer recommended</b>. Please update to Conan 2, <a href="https://docs.conan.io/2/">click here to read the <b>Conan 2</b> documentation</a></p>
            </div>
            
            <div style="border: 2px solid #c6ac58;background-color: #f7ecc6;padding: 3px">
              <p>Conan Center has stopped receiving updates for Conan 1.x packages. A new https://center2.conan.io Conan 2-only remote is now available. <a href="https://blog.conan.io/2024/09/30/Conan-Center-will-stop-receiving-updates-for-Conan-1.html">Read the blog post</a></p>
            </div>
          </div>
          <!--@ OUTDATED_VERSION_PLACEHOLDER_BEGIN @
          <div>
            <div class="admonition warning wy-text-center" style="position:sticky">
              <p>This document is for an <b>outdated</b> Conan version.
              <a href="https://docs.conan.io/2/@LATEST_DOC_PAGE_URL@">Click here to read the <b>latest</b> documentation</a></p>
             </div>
          </div>
          @ OUTDATED_VERSION_PLACEHOLDER_END @-->
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../reference.html">Reference</a></li>
          <li class="breadcrumb-item"><a href="../../../conanfile.html">conanfile.py</a></li>
          <li class="breadcrumb-item"><a href="../../tools.html">tools</a></li>
          <li class="breadcrumb-item"><a href="../scm.html">conan.tools.scm</a></li>
      <li class="breadcrumb-item active">Git</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/master/reference/conanfile/tools/scm/git.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="git">
<span id="conan-tools-scm-git"></span><h1>Git<a class="headerlink" href="#git" title="Link to this heading"></a></h1>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>This feature is still <strong>under development</strong>, while it is recommended and usable and we will try not to break them in future releases,
some breaking changes might still happen if necessary to prepare for the <em>Conan 2.0 release</em>.</p>
<p>This tool is intended to replace the current <code class="docutils literal notranslate"><span class="pre">conans.tools.Git</span></code> and the current <code class="docutils literal notranslate"><span class="pre">scm</span></code> attribute, that will be removed in Conan 2.0.</p>
</div>
<p>Available since: <a class="reference external" href="https://github.com/conan-io/conan/releases/tag/1.46.0">1.46.0</a></p>
<section id="constructor">
<h2>constructor<a class="headerlink" href="#constructor" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conanfile</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Construct a <code class="docutils literal notranslate"><span class="pre">Git</span></code> object, specifying the current directory, by default <code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code>, the current working directory.</p>
</section>
<section id="get-commit">
<h2>get_commit()<a class="headerlink" href="#get-commit" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_commit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Returns the current commit, with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rev-list</span> <span class="pre">HEAD</span> <span class="pre">-n</span> <span class="pre">1</span> <span class="pre">--</span> <span class="pre">&lt;folder&gt;</span></code>. The latest commit is returned, irrespective of local not committed changes.</p>
</section>
<section id="get-remote-url">
<h2>get_remote_url()<a class="headerlink" href="#get-remote-url" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_remote_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Obtains the URL of the <code class="docutils literal notranslate"><span class="pre">remote</span></code> git remote repository, with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">-v</span></code></p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This method will get the output from <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">-v</span></code>. If you added tokens or credentials to the remote in the URL, they will be
exposed. Credentials shouldn’t be added to git remotes definitions, but using a credentials manager or similar mechanism.
If you still want to use this approach, it is your responsibility to strip the credentials from the result.</p>
</div>
</section>
<section id="commit-in-remote">
<h2>commit_in_remote()<a class="headerlink" href="#commit-in-remote" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">commit_in_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Checks that the given commit exists in the remote, with <code class="docutils literal notranslate"><span class="pre">branch</span> <span class="pre">-r</span> <span class="pre">--contains</span> <span class="pre">&lt;commit&gt;</span></code> and checking an occurrence of a branch in that remote exists.</p>
</section>
<section id="is-dirty">
<h2>is_dirty()<a class="headerlink" href="#is-dirty" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_dirty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Returns if the current folder is dirty, running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span> <span class="pre">-s</span></code></p>
</section>
<section id="get-repo-root">
<h2>get_repo_root()<a class="headerlink" href="#get-repo-root" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_repo_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Returns the current repository top folder with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rev-parse</span> <span class="pre">--show-toplevel</span></code></p>
</section>
<section id="clone">
<h2>clone()<a class="headerlink" href="#clone" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Performs a <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">&lt;url&gt;</span> <span class="pre">&lt;args&gt;</span> <span class="pre">&lt;target&gt;</span></code> operation,
where <cite>target</cite> is the target directory.</p>
<p>Optional arguments can be passed as a list, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.scm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Git</span>

<span class="k">class</span><span class="w"> </span><span class="nc">App</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.2.3&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">clone_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--depth&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;--branch&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">]</span>
        <span class="n">git</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://path/to/repo.git&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">clone_args</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="checkout">
<h2>checkout()<a class="headerlink" href="#checkout" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">checkout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="p">)</span>
</pre></div>
</div>
<p>Checkouts the given commit</p>
</section>
<section id="get-url-and-commit">
<h2>get_url_and_commit()<a class="headerlink" href="#get-url-and-commit" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_url_and_commit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span>
    <span class="c1"># returns a (url, commit) tuple</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This method will get the output from <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">-v</span></code>. If you added tokens or credentials to the remote in the URL, they will be
exposed. Credentials shouldn’t be added to git remotes definitions, but using a credentials manager or similar mechanism.
If you still want to use this approach, it is your responsibility to strip the credentials from the result.</p>
</div>
<p>This is an advanced method, that returns both the current commit, and the remote repository url.
This method is intended to capture the current remote coordinates for a package creation, so that can be used later to build
again from sources from the same commit. This is the behavior:</p>
<ul class="simple">
<li><p>If the repository is dirty, it will raise an exception. Doesn’t make sense to capture coordinates of something dirty, as
it will not be reproducible. If there are local changes, and the user wants to test a local <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code>, should commit
the changes first (locally, not push the changes).</p></li>
<li><p>If the repository is not dirty, but the commit doesn’t exist in the given remote, the method will return that commit and the
URL of the local user checkout. This way, a package can be <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> created locally, testing everything works, before
pushing some changes to the remote.</p></li>
<li><p>If the repository is not dirty, and the commit exists in the specified remote, it will return that commit and the url of the
remote.</p></li>
</ul>
</section>
<section id="included-files">
<h2>included_files()<a class="headerlink" href="#included-files" title="Link to this heading"></a></h2>
<p>Returns the list of files not ignored by <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">included_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
<p>This method runs <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">ls-files</span> <span class="pre">--full-name</span> <span class="pre">--others</span> <span class="pre">--cached</span> <span class="pre">--exclude-standard</span></code> and returns the result as a list.
It can be used for implementing a controlled <code class="docutils literal notranslate"><span class="pre">export</span></code> of files not gitignored, something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">included</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">included_files</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">included</span><span class="p">:</span>
        <span class="n">dst</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_sources_folder</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dst</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fetch-commit">
<h2>fetch_commit()<a class="headerlink" href="#fetch-commit" title="Link to this heading"></a></h2>
<p>Can be used to efficiently retrieve just 1 commit from the server, instead of doing a full clone, which can be slower.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">git</span><span class="o">.</span><span class="n">fetch_commit</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;repo-url&quot;</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="s2">&quot;specific-commit&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this can fail if the server does not support this fetch mode. Most of modern servers like Github, Gitlab support it,
but if you host your own server, please check.</p>
</section>
<section id="run">
<h2>run()<a class="headerlink" href="#run" title="Link to this heading"></a></h2>
<p>Available since: <a class="reference external" href="https://github.com/conan-io/conan/releases/tag/1.53.0">1.53.0</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<p>Executes <cite>git &lt;cmd&gt;</cite> and returns the console output of the command.</p>
<p>For example, if you want to print the git version, just pass <code class="docutils literal notranslate"><span class="pre">cmd=&quot;--version&quot;</span></code> as
argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.scm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Git</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pkg</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pkg&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">git</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;--version&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="example-implementing-the-scm-feature">
<h2>Example: Implementing the <code class="docutils literal notranslate"><span class="pre">scm</span></code> feature<a class="headerlink" href="#example-implementing-the-scm-feature" title="Link to this heading"></a></h2>
<p>This example is the new way to implement the <code class="docutils literal notranslate"><span class="pre">scm</span></code> feature (the <code class="docutils literal notranslate"><span class="pre">scm</span></code> attribute will be removed in Conan 2.0, and the way it will survive is the one described in this section), using this new <code class="docutils literal notranslate"><span class="pre">Git</span></code> capabilities.</p>
<p>Assume we have this project with this layout, in a git repository:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>├── conanfile.py
├── CMakeLists.txt
├── src
│   └── hello.cpp
</pre></div>
</div>
<p>And the conanfile.py is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.scm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Git</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">update_conandata</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Pkg</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pkg&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipe_folder</span><span class="p">)</span>
        <span class="n">scm_url</span><span class="p">,</span> <span class="n">scm_commit</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">get_url_and_commit</span><span class="p">()</span>
        <span class="c1"># we store the current url and commit in conandata.yml</span>
        <span class="n">update_conandata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;commit&quot;</span><span class="p">:</span> <span class="n">scm_commit</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">scm_url</span><span class="p">}})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we recover the saved url and commit from conandata.yml and use them to get sources</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conan_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span>
        <span class="n">git</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">sources</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">git</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="n">sources</span><span class="p">[</span><span class="s2">&quot;commit&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># build() will have access to the sources, obtained with the clone in source()</span>
        <span class="n">cmake</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="s2">&quot;CMakeLists.txt&quot;</span><span class="p">)</span>
        <span class="n">hello</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="s2">&quot;src/hello.cpp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MYCMAKE-BUILD: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmake</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MYFILE-BUILD: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hello</span><span class="p">)))</span>
</pre></div>
</div>
<p>This conanfile does:</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">export()</span></code> method, it captures the url and commit, according to the rules of <code class="docutils literal notranslate"><span class="pre">get_url_and_commit()</span></code> above</p></li>
<li><p>The url and commit are saved in the <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code></p></li>
<li><p>These two first steps happen in the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">export</span></code> or first part of <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> when the recipe is exported to the cache.</p></li>
<li><p>When the recipe is building from sources in the cache, it will call the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method which will clone and checkout from
the user folder if the commit is only local or from the git remote if the commit is remote too.</p></li>
</ul>
<p>This <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> flow is not recommended for continuous usage. To develop and test, users should use the local flow (<code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> + build system).
Only in the last stage, to check that things are looking good to push, the user can do a local commit, and before pushing, do a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> to check
locally.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../scm.html" class="btn btn-neutral float-left" title="conan.tools.scm" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="other.html" class="btn btn-neutral float-right" title="conan_version" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最后更新于 2月 16, 2026.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>