<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Core guidelines &mdash; conan 2.11.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/knowledge/guidelines.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=57357224"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Cheat sheet" href="cheatsheet.html" />


 



</script>
<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci_tutorial/tutorial.html">CI 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devops/devops.html">Devops guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../knowledge.html">Knowledge</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cheatsheet.html">Cheat sheet</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Core guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../incubating.html">Incubating features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../knowledge.html">Knowledge</a></li>
      <li class="breadcrumb-item active">Core guidelines</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/knowledge/guidelines.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="core-guidelines">
<span id="guidelines"></span><h1>Core guidelines<a class="headerlink" href="#core-guidelines" title="Link to this heading">¶</a></h1>
<section id="good-practices">
<h2>Good practices<a class="headerlink" href="#good-practices" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>build() should be simple, prepare the builds in generate() instead</strong>:
The recipes’ <code class="docutils literal notranslate"><span class="pre">generate()</span></code> method purpose is to prepare the build as much as possible.
Users calling <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> will execute this method, and the generated files should
allow users to do “native” builds (calling directly “cmake”, “meson”, etc.) as easy as possible.
Thus, avoiding as much as possible any logic in the <code class="docutils literal notranslate"><span class="pre">build()</span></code> method, and moving it to
the <code class="docutils literal notranslate"><span class="pre">generate()</span></code> method helps developers achieve the same build locally as the one that
would be produced by a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> build in the local cache.</p></li>
<li><p><strong>Always use your own profiles in production</strong>, instead of relying on the auto-detected profile,
as the output of such auto detection can vary over time, resulting in unexpected results.
Profiles (and many other configuration), can be managed with <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">config</span> <span class="pre">install</span></code>.</p></li>
<li><p><strong>Developers should not be able to upload to “development” and “production” repositories</strong> in the server.
Only CI builds have write permissions in the server. Developers should only have read permissions and
at most to some “playground” repositories used to work and share things with colleagues,
but which packages are never used, moved or copied to the development or production repositories.</p></li>
<li><p><strong>The test_package purpose is to validate the correct creation of the package, not for functional testing</strong>. The <code class="docutils literal notranslate"><span class="pre">test_package</span></code> purpose is to check that the package has been correctly created (that is,
that it has correctly packaged the headers, the libraries, etc, in the right folders), not that
the functionality of the package is correct. Then, it should be kept as simple as possible, like
building and running an executable that uses the headers and links against a packaged library
should be enough. Such execution should be as simple as possible too. Any kind of
unit and functional tests should be done in the <code class="docutils literal notranslate"><span class="pre">build()</span></code> method.</p></li>
<li><p><strong>All input sources must be common for all binary configurations</strong>: All the “source” inputs, including the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code>, the <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code>, the <code class="docutils literal notranslate"><span class="pre">exports</span></code> and <code class="docutils literal notranslate"><span class="pre">exports_source</span></code>, the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method, patches applied in the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method, cannot be conditional to anything, platform, OS or compiler, as they are shared among all configurations. Furthermore, the line endings for all these things should be the same, it is recommended to use always just line-feeds in all platforms, and do not convert or checkout to <code class="docutils literal notranslate"><span class="pre">crlf</span></code> in Windows, as that will cause different recipe revisions.</p></li>
<li><p><strong>Keep ``python_requires`` as simple as possible</strong>. Avoid transitive <code class="docutils literal notranslate"><span class="pre">python_requires</span></code>, keep them
as reduced as possible, and at most, require them explicitly in a “flat” structure, without
<code class="docutils literal notranslate"><span class="pre">python_requires</span></code> requiring other <code class="docutils literal notranslate"><span class="pre">python_requires</span></code>. Avoid inheritance (via <code class="docutils literal notranslate"><span class="pre">python_requires_extend</span></code>)
if not strictly necessary, and avoid multiple inheritance at all costs, as it is extremely
complicated, and it does not work the same as the built-in Python one.</p></li>
<li><p>At the moment the <strong>Conan cache is not concurrent</strong>. Avoid any kind of concurrency or parallelism,
for example different parallel CI jobs should use different caches (with CONAN_HOME env-var). This might
change in the future and we will work on providing concurrency in the cache, but until then,
use isolated caches for concurrent tasks.</p></li>
<li><p><strong>Avoid ‘force’ and ‘override’ traits as a versioning mechanism.</strong> The <code class="docutils literal notranslate"><span class="pre">force</span></code> and <code class="docutils literal notranslate"><span class="pre">override</span></code> traits to
solve conflicts are not recommended as a general versioning solution, just as a temporary workaround to solve
a version conflict. Its usage should be avoided whenever possible, and updating versions or version ranges in
the graph to avoid the conflicts without overrides and forces is the recommended approach.</p></li>
<li><p><strong>Please, do not abuse ‘tool_requires’</strong>. Those are intended only for executables like <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ninja</span></code> running in the “build”
context, not for libraries or library-like dependencies, that must use <code class="docutils literal notranslate"><span class="pre">requires</span></code> or <code class="docutils literal notranslate"><span class="pre">test_requires</span></code>.</p></li>
<li><p>Positional arguments when invoking Conan should be specified first, before any named argument. For example,
<code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span> <span class="pre">.</span> <span class="pre">-s=&quot;os=Windows&quot;</span></code> is correct, but <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span> <span class="pre">-s=&quot;os=Windows&quot;</span> <span class="pre">.</span></code> is not.
Likewise, it’s recommended to use <code class="docutils literal notranslate"><span class="pre">=</span></code> instead of spaces between the name and value of named arguments.
This is to avoid some ambiguity scenarios when parsing the command line arguments.</p></li>
<li><p><strong>It is strongly discouraged to use user/channel</strong> for any quality, stage, maturity or variable information
The <code class="docutils literal notranslate"><span class="pre">channel</span></code> part is very legacy, and should be avoided in most cases, or use a fixed string as <code class="docutils literal notranslate"><span class="pre">stable</span></code>.
The <code class="docutils literal notranslate"><span class="pre">user</span></code> might be used for intra-organization private packages, while the recommendation for packages coming
from ConanCenter or forks of <code class="docutils literal notranslate"><span class="pre">conan-center-index</span></code> Github repo is to use them without any user or channel, like
the <code class="docutils literal notranslate"><span class="pre">zlib/1.3.1</span></code> ConanCenter references, even for customization of the recipes and packages for those third party
libraries.</p></li>
<li><p>The way to manage package quality, stage or maturity <strong>promotions is by using different server repositories</strong>, and the well known developer’s
best practices recommend to manage the pipelines by doing promotions (copying) immutable artifacts or packages between
those different server repositories, for example copying packages from a <code class="docutils literal notranslate"><span class="pre">staging</span></code> repository to a <code class="docutils literal notranslate"><span class="pre">production</span></code> repository
once they have passed some quality checks. But it is very important that this promotion does not change in any way those
packages, which must be completely immutable, not even changing its <code class="docutils literal notranslate"><span class="pre">user/channel</span></code>, this is why the above point discourages
using user and channel, packages and artifacts must be immutable.</p></li>
</ul>
</section>
<section id="forbidden-practices">
<h2>Forbidden practices<a class="headerlink" href="#forbidden-practices" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Conan is not re-entrant</strong>: Calling the Conan process from Conan itself cannot be done. That includes calling
Conan from recipe code, hooks, plugins, and basically every code that already executes when
Conan is called. Doing it will result in undefined behavior. For example it is not valid
to run <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">search</span></code> from a <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code>. This includes indirect calls, like running
Conan from a build script (like <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>) while this build script is already being
executed as a result of a Conan invocation. For the same reason <strong>Conan Python API cannot be used from recipes</strong>: The Conan Python API can only be called from Conan custom commands or from user Python scripts,
but never from <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> recipes, hooks, extensions, plugins, or any other code
executed by Conan.</p></li>
<li><p><strong>Settings and configuration (conf) are read-only in recipes</strong>: The settings and configuration cannot be defined or assigned values in recipes. Something like <code class="docutils literal notranslate"><span class="pre">self.settings.compiler</span> <span class="pre">=</span> <span class="pre">&quot;gcc&quot;</span></code> in recipes shouldn’t be done. That is undefined behavior and can crash at any time, or just be ignored. Settings and configuration can only be defined in profiles, in command line arguments or in the <code class="docutils literal notranslate"><span class="pre">profile.py</span></code> plugin.</p></li>
<li><p><strong>Recipes reserved names</strong>: Conan <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> recipes user attributes and methods should always start with <code class="docutils literal notranslate"><span class="pre">_</span></code>.
Conan reserves the “public” namespace for all attributes and methods, and <code class="docutils literal notranslate"><span class="pre">_conan</span></code> for
private ones. Using any non-documented Python function, method, class, attribute, even if
it is “public” in the Python sense, is undefined behavior if such element is not documented
in this documentation.</p></li>
<li><p><strong>Conan artifacts are immutable</strong>: Conan packages and artifacts, once they are in the Conan cache, they are assumed to be immutable.
Any attempt to modify the exported sources, the recipe, the conandata.yml or any of the exported
or the packaged artifacts, is undefined behavior. For example, it is not possible to modify the
contents of a package inside the  <code class="docutils literal notranslate"><span class="pre">package_info()</span></code> method or the <code class="docutils literal notranslate"><span class="pre">package_id()</span></code> method, those
methods should never modify, delete or create new files inside the packages. If you need to modify
some package, you might use your own custom <code class="docutils literal notranslate"><span class="pre">deployer</span></code>.</p></li>
<li><p><strong>Conan cache paths are internal implementation detail</strong>: The Conan cache paths are an internal implementation detail. Conan recipes provide abstractions
like <code class="docutils literal notranslate"><span class="pre">self.build_folder</span></code> to represent the necessary information about folders, and commands
like <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">cache</span> <span class="pre">path</span></code> to get information of the current folders. The Conan cache might
be checked while debugging, as read-only, but it is not allowed to edit, modify or delete
artifacts or files from the Conan cache by any other means that Conan command line or public API.</p></li>
<li><p><strong>Sources used in recipes must be immutable</strong>. Once a recipe is exported to the Conan cache, it is expected that the sources are immutable, that is, that retrieving the sources in the future will always retrieve the exact same sources. It is not allowed to use moving targets like a <code class="docutils literal notranslate"><span class="pre">git</span></code> branch or a download of a file that is continuously rewritten in the server. <code class="docutils literal notranslate"><span class="pre">git</span></code> checkouts must be of an immutable tag or a commit, and <code class="docutils literal notranslate"><span class="pre">download()/get()</span></code> must use checksums to verify the server files doesn’t change. Not using immutable sources will be undefined behavior.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cheatsheet.html" class="btn btn-neutral float-left" title="Cheat sheet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最后更新于 10月 28, 2025.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>