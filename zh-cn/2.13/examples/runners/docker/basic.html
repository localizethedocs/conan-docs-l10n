<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating a Conan package using a Docker runner &mdash; conan 2.13.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/examples/runners/docker/basic.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=b2c15d51"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/translations.js?v=beaddf03"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="Using a docker runner configfile to parameterize a Dockerfile" href="configfile_build_args.html" />
    <link rel="prev" title="Conan runners examples" href="../../runners.html" />


 



</script>
<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.13
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ci_tutorial/tutorial.html">CI 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devops/devops.html">Devops guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../conanfile.html">ConanFile methods examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extensions.html">Conan extensions examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools.html">Conan recipe tools examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cross_build.html">Cross-building examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config_files.html">Configuration files examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../graph.html">Graph examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_flow.html">Developer tools and flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../commands.html">Conan commands examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../runners.html">Conan runners examples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Creating a Conan package using a Docker runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="configfile_build_args.html">Using a docker runner configfile to parameterize a Dockerfile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../incubating.html">Incubating features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../examples.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../../runners.html">Conan runners examples</a></li>
      <li class="breadcrumb-item active">Creating a Conan package using a Docker runner</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/runners/docker/basic.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-a-conan-package-using-a-docker-runner">
<span id="examples-runners-docker-basic"></span><h1>Creating a Conan package using a Docker runner<a class="headerlink" href="#creating-a-conan-package-using-a-docker-runner" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This feature is experimental and subject to breaking changes.
See <a class="reference internal" href="../../../introduction.html#stability"><span class="std std-ref">the Conan stability</span></a> section for more information.</p>
</div>
<p>First of all you need to have the Docker daemon installed and running, plus Conan and the <code class="docutils literal notranslate"><span class="pre">docker</span></code> Python package. This tutorial assumes that you are running Conan inside a Python virtual environment, skip the first line if you already have the <code class="docutils literal notranslate"><span class="pre">docker</span></code> Python package installed in your virtual environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install docker in your virtual environment if you don&#39;t have it already installed</span>
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>conan<span class="w"> </span>docker
$<span class="w"> </span>docker<span class="w"> </span>ps
$<span class="w"> </span>CONTAINER<span class="w"> </span>ID<span class="w">   </span>IMAGE<span class="w">     </span>COMMAND<span class="w">   </span>CREATED<span class="w">   </span>STATUS<span class="w">    </span>PORTS<span class="w">     </span>NAMES
</pre></div>
</div>
<p>Now we are going to create create simple <code class="docutils literal notranslate"><span class="pre">cmake_lib</span></code> Conan template to later run inside Docker using the runner feature. Let’s create the Conan package and a Dockerfile inside our project folder.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;/my/runner/folder&gt;
$<span class="w"> </span>mkdir<span class="w"> </span>mylib
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>mylib
$<span class="w"> </span>conan<span class="w"> </span>new<span class="w"> </span>cmake_lib<span class="w"> </span>-d<span class="w"> </span><span class="nv">name</span><span class="o">=</span>mylib<span class="w"> </span>-d<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="m">0</span>.1
$<span class="w"> </span>tree
.
├──<span class="w"> </span>CMakeLists.txt
├──<span class="w"> </span>conanfile.py
├──<span class="w"> </span>include
│<span class="w">   </span>└──<span class="w"> </span>mylib.h
├──<span class="w"> </span>src
│<span class="w">   </span>└──<span class="w"> </span>mylib.cpp
└──<span class="w"> </span>test_package
<span class="w">    </span>├──<span class="w"> </span>CMakeLists.txt
<span class="w">    </span>├──<span class="w"> </span>conanfile.py
<span class="w">    </span>└──<span class="w"> </span>src
<span class="w">        </span>└──<span class="w"> </span>example.cpp
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code></p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:22.04</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--no-install-recommends<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>build-essential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>cmake<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>python3<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>python3-pip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>python3-venv<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>conan
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;/my/runner/folder&gt;/mylib
$<span class="w"> </span>tree
.
...
├──<span class="w"> </span>Dockerfile
...
</pre></div>
</div>
<p>Now, we need to define two new profiles inside the conan <code class="docutils literal notranslate"><span class="pre">profiles</span></code> folder. Replace <code class="docutils literal notranslate"><span class="pre">&lt;/my/runner/folder&gt;</span></code> with your real project folder path.</p>
<p><code class="docutils literal notranslate"><span class="pre">docker_example_host</span></code> profile</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[settings]
arch=x86_64
build_type=Release
compiler=gcc
compiler.cppstd=gnu17
compiler.libcxx=libstdc++11
compiler.version=11
os=Linux

[runner]
type=docker
dockerfile=&lt;/my/runner/folder&gt;/mylib
cache=copy
remove=true
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">docker_example_build</span></code> profile</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>settings<span class="o">]</span>
<span class="nv">arch</span><span class="o">=</span>x86_64
<span class="nv">build_type</span><span class="o">=</span>Release
<span class="nv">compiler</span><span class="o">=</span>gcc
compiler.cppstd<span class="o">=</span>gnu17
compiler.libcxx<span class="o">=</span>libstdc++11
compiler.version<span class="o">=</span><span class="m">11</span>
<span class="nv">os</span><span class="o">=</span>Linux
</pre></div>
</div>
<p>We are going to start from a totally clean environment, without any containers, images or conan package.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>list<span class="w"> </span><span class="s2">&quot;*:*&quot;</span>
Found<span class="w"> </span><span class="m">0</span><span class="w"> </span>pkg/version<span class="w"> </span>recipes<span class="w"> </span>matching<span class="w"> </span>*<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">local</span><span class="w"> </span>cache
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span>--all
CONTAINER<span class="w"> </span>ID<span class="w">   </span>IMAGE<span class="w">     </span>COMMAND<span class="w">   </span>CREATED<span class="w">   </span>STATUS<span class="w">    </span>PORTS<span class="w">     </span>NAMES
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>docker<span class="w"> </span>images
REPOSITORY<span class="w">   </span>TAG<span class="w">       </span>IMAGE<span class="w"> </span>ID<span class="w">   </span>CREATED<span class="w">   </span>SIZE
</pre></div>
</div>
<p>Now, it’s time to create our library <code class="docutils literal notranslate"><span class="pre">mylib</span></code> using our new runner definition.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>--version<span class="w"> </span><span class="m">0</span>.1<span class="w"> </span>-pr:h<span class="w"> </span>docker_example_host<span class="w"> </span>-pr:b<span class="w"> </span>docker_example_build
</pre></div>
</div>
<p>If we split and analyze the command output, we can see what is happening and where the commands are being executed.</p>
<p><strong>1.</strong> Standard conan execution.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">========</span><span class="w"> </span>Exporting<span class="w"> </span>recipe<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span><span class="nv">cache</span><span class="w"> </span><span class="o">========</span>
mylib/0.1:<span class="w"> </span>Exporting<span class="w"> </span>package<span class="w"> </span>recipe:<span class="w"> </span>&lt;/my/runner/folder&gt;/mylib/conanfile.py
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.py&#39;</span><span class="w"> </span>file:<span class="w"> </span>conanfile.py
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.txt&#39;</span><span class="w"> </span>file:<span class="w"> </span>CMakeLists.txt
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.h&#39;</span><span class="w"> </span>file:<span class="w"> </span>mylib.h
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.cpp&#39;</span><span class="w"> </span>file:<span class="w"> </span>mylib.cpp
mylib/0.1:<span class="w"> </span>Exported<span class="w"> </span>to<span class="w"> </span>cache<span class="w"> </span>folder:<span class="w"> </span>/Users/davidsanfal/.conan2/p/mylib4abd06a04bdaa/e
mylib/0.1:<span class="w"> </span>Exported:<span class="w"> </span>mylib/0.1#8760bf5a311f01cc26f3b95428203210<span class="w"> </span><span class="o">(</span><span class="m">2024</span>-07-08<span class="w"> </span><span class="m">12</span>:22:01<span class="w"> </span>UTC<span class="o">)</span>

<span class="o">========</span><span class="w"> </span>Input<span class="w"> </span><span class="nv">profiles</span><span class="w"> </span><span class="o">========</span>
Profile<span class="w"> </span>host:
<span class="o">[</span>settings<span class="o">]</span>
<span class="nv">arch</span><span class="o">=</span>x86_64
<span class="nv">build_type</span><span class="o">=</span>Release
<span class="nv">compiler</span><span class="o">=</span>gcc
compiler.cppstd<span class="o">=</span>gnu17
compiler.libcxx<span class="o">=</span>libstdc++11
compiler.version<span class="o">=</span><span class="m">11</span>
<span class="nv">os</span><span class="o">=</span>Linux

Profile<span class="w"> </span>build:
<span class="o">[</span>settings<span class="o">]</span>
<span class="nv">arch</span><span class="o">=</span>x86_64
<span class="nv">build_type</span><span class="o">=</span>Release
<span class="nv">compiler</span><span class="o">=</span>gcc
compiler.cppstd<span class="o">=</span>gnu17
compiler.libcxx<span class="o">=</span>libstdc++11
compiler.version<span class="o">=</span><span class="m">11</span>
<span class="nv">os</span><span class="o">=</span>Linux
</pre></div>
</div>
<p><strong>2.</strong> Build docker image</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>**********************************************
*<span class="w"> </span>Building<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>image:<span class="w"> </span>my-conan-runner<span class="w"> </span>*
**********************************************

Dockerfile<span class="w"> </span>path:<span class="w"> </span><span class="s1">&#39;&lt;/my/runner/folder&gt;/mylib/Dockerfile&#39;</span>
Docker<span class="w"> </span>build<span class="w"> </span>context:<span class="w"> </span><span class="s1">&#39;&lt;/my/runner/folder&gt;/mylib&#39;</span>

Step<span class="w"> </span><span class="m">1</span>/4<span class="w"> </span>:<span class="w"> </span>FROM<span class="w"> </span>ubuntu:22.04

...

---&gt;<span class="w"> </span>2bcf70201cce
Successfully<span class="w"> </span>built<span class="w"> </span>2bcf70201cce
Successfully<span class="w"> </span>tagged<span class="w"> </span>conan-runner-default:latest
</pre></div>
</div>
<p><strong>3.</strong> Save the local cache running <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">cache</span> <span class="pre">save</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>***********************************************************************************
*<span class="w"> </span>Save<span class="w"> </span>host<span class="w"> </span>cache<span class="w"> </span><span class="k">in</span>:<span class="w"> </span>&lt;/my/runner/folder&gt;/mylib/.conanrunner/local_cache_save.tgz<span class="w"> </span>*
***********************************************************************************

Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>pkg/version<span class="w"> </span>recipes<span class="w"> </span>matching<span class="w"> </span>*<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">local</span><span class="w"> </span>cache
Saving<span class="w"> </span>mylib/0.1:<span class="w"> </span>mylib4abd06a04bdaa
</pre></div>
</div>
<p><strong>4.</strong> Create and initialize the docker container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*********************************
*<span class="w"> </span>Creating<span class="w"> </span>the<span class="w"> </span>docker<span class="w"> </span>container<span class="w"> </span>*
*********************************

*****************************************
*<span class="w"> </span>Container<span class="w"> </span>conan-runner-docker<span class="w"> </span>running<span class="w"> </span>*
*****************************************
</pre></div>
</div>
<p><strong>5.</strong> Check if the container has a conan version with the runner feature.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*******************************************
*<span class="w"> </span>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>container:<span class="w"> </span><span class="s2">&quot;conan --version&quot;</span><span class="w"> </span>*
*******************************************

Conan<span class="w"> </span>version<span class="w"> </span><span class="m">2</span>.5.0
</pre></div>
</div>
<p><strong>6.</strong> Initialize the container conan cache using the host copy running <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">cache</span> <span class="pre">restore</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>***********************************************************************************************************
*<span class="w"> </span>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>container:<span class="w"> </span><span class="s2">&quot;conan cache restore &quot;</span>/root/conanrunner/mylib/.conanrunner/local_cache_save.tgz<span class="s2">&quot;&quot;</span><span class="w"> </span>*
***********************************************************************************************************

Restore:<span class="w"> </span>mylib/0.1<span class="w"> </span><span class="k">in</span><span class="w"> </span>mylib4abd06a04bdaa
Local<span class="w"> </span>Cache
mylib
<span class="w">    </span>mylib/0.1
<span class="w">    </span>revisions
<span class="w">        </span>8760bf5a311f01cc26f3b95428203210<span class="w"> </span><span class="o">(</span><span class="m">2024</span>-07-08<span class="w"> </span><span class="m">12</span>:22:19<span class="w"> </span>UTC<span class="o">)</span>
<span class="w">        </span>packages
<span class="w">        </span>recipe_folder:<span class="w"> </span>mylib4abd06a04bdaa
</pre></div>
</div>
<p><strong>7.</strong> Run the conan create inside the container and build “mylib”.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*********************************************************************************************************************************************************
*<span class="w"> </span>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>container:<span class="w"> </span><span class="s2">&quot;conan create /root/conanrunner/mylib --version 0.1 -pr:h docker_example_host -pr:b docker_example_build -f json &gt; create.json&quot;</span><span class="w"> </span>*
*********************************************************************************************************************************************************


<span class="o">========</span><span class="w"> </span>Exporting<span class="w"> </span>recipe<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span><span class="nv">cache</span><span class="w"> </span><span class="o">========</span>
mylib/0.1:<span class="w"> </span>Exporting<span class="w"> </span>package<span class="w"> </span>recipe:<span class="w"> </span>/root/conanrunner/mylib/conanfile.py
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.py&#39;</span><span class="w"> </span>file:<span class="w"> </span>conanfile.py
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.txt&#39;</span><span class="w"> </span>file:<span class="w"> </span>CMakeLists.txt
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.cpp&#39;</span><span class="w"> </span>file:<span class="w"> </span>mylib.cpp
mylib/0.1:<span class="w"> </span>Copied<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;.h&#39;</span><span class="w"> </span>file:<span class="w"> </span>mylib.h
mylib/0.1:<span class="w"> </span>Exported<span class="w"> </span>to<span class="w"> </span>cache<span class="w"> </span>folder:<span class="w"> </span>/root/.conan2/p/mylib4abd06a04bdaa/e
mylib/0.1:<span class="w"> </span>Exported:<span class="w"> </span>mylib/0.1#8760bf5a311f01cc26f3b95428203210<span class="w"> </span><span class="o">(</span><span class="m">2024</span>-07-08<span class="w"> </span><span class="m">12</span>:22:20<span class="w"> </span>UTC<span class="o">)</span>

<span class="o">========</span><span class="w"> </span>Input<span class="w"> </span><span class="nv">profiles</span><span class="w"> </span><span class="o">========</span>
Profile<span class="w"> </span>host:
<span class="o">[</span>settings<span class="o">]</span>
<span class="nv">arch</span><span class="o">=</span>x86_64
<span class="nv">build_type</span><span class="o">=</span>Release
<span class="nv">compiler</span><span class="o">=</span>gcc
compiler.cppstd<span class="o">=</span>gnu17
compiler.libcxx<span class="o">=</span>libstdc++11
compiler.version<span class="o">=</span><span class="m">11</span>
<span class="nv">os</span><span class="o">=</span>Linux

Profile<span class="w"> </span>build:
<span class="o">[</span>settings<span class="o">]</span>
<span class="nv">arch</span><span class="o">=</span>x86_64
<span class="nv">build_type</span><span class="o">=</span>Release
<span class="nv">compiler</span><span class="o">=</span>gcc
compiler.cppstd<span class="o">=</span>gnu17
compiler.libcxx<span class="o">=</span>libstdc++11
compiler.version<span class="o">=</span><span class="m">11</span>
<span class="nv">os</span><span class="o">=</span><span class="nv">Linux</span>


<span class="o">========</span><span class="w"> </span>Computing<span class="w"> </span>dependency<span class="w"> </span><span class="nv">graph</span><span class="w"> </span><span class="o">========</span>
Graph<span class="w"> </span>root
<span class="w">    </span>cli
Requirements
<span class="w">    </span>mylib/0.1#8760bf5a311f01cc26f3b95428203210<span class="w"> </span>-<span class="w"> </span><span class="nv">Cache</span>

<span class="o">========</span><span class="w"> </span>Computing<span class="w"> </span>necessary<span class="w"> </span><span class="nv">packages</span><span class="w"> </span><span class="o">========</span>
mylib/0.1:<span class="w"> </span>Forced<span class="w"> </span>build<span class="w"> </span>from<span class="w"> </span><span class="nb">source</span>
Requirements
<span class="w">    </span>mylib/0.1#8760bf5a311f01cc26f3b95428203210:8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe<span class="w"> </span>-<span class="w"> </span><span class="nv">Build</span>

<span class="o">========</span><span class="w"> </span>Installing<span class="w"> </span><span class="nv">packages</span><span class="w"> </span><span class="o">========</span>

--------<span class="w"> </span>Installing<span class="w"> </span>package<span class="w"> </span>mylib/0.1<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>--------


...

<span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>CXX<span class="w"> </span>object<span class="w"> </span>CMakeFiles/example.dir/src/example.cpp.o
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>CXX<span class="w"> </span>executable<span class="w"> </span>example
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="w"> </span>Built<span class="w"> </span>target<span class="w"> </span><span class="nv">example</span>


<span class="o">========</span><span class="w"> </span>Testing<span class="w"> </span>the<span class="w"> </span>package:<span class="w"> </span>Executing<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="o">========</span>
mylib/0.1<span class="w"> </span><span class="o">(</span><span class="nb">test</span><span class="w"> </span>package<span class="o">)</span>:<span class="w"> </span>Running<span class="w"> </span>test<span class="o">()</span>
mylib/0.1<span class="w"> </span><span class="o">(</span><span class="nb">test</span><span class="w"> </span>package<span class="o">)</span>:<span class="w"> </span>RUN:<span class="w"> </span>./example
mylib/0.1:<span class="w"> </span>Hello<span class="w"> </span>World<span class="w"> </span>Release!
mylib/0.1:<span class="w"> </span>__x86_64__<span class="w"> </span>defined
mylib/0.1:<span class="w"> </span>_GLIBCXX_USE_CXX11_ABI<span class="w"> </span><span class="m">1</span>
mylib/0.1:<span class="w"> </span>__cplusplus201703
mylib/0.1:<span class="w"> </span>__GNUC__11
mylib/0.1:<span class="w"> </span>__GNUC_MINOR__4
mylib/0.1<span class="w"> </span>test_package
</pre></div>
</div>
<p><strong>8.</strong> Copy just the package created inside the container using the <code class="docutils literal notranslate"><span class="pre">pkglist.json</span></code> info from the previous <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code>, restore this new package inside the host cache running a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">cache</span> <span class="pre">save</span></code> and remove the container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>************************************************************************************************************************************
*<span class="w"> </span>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>container:<span class="w"> </span><span class="s2">&quot;conan cache save --list=pkglist.json --file &quot;</span>/root/conanrunner/mylib<span class="s2">&quot;/.conanrunner/docker_cache_save.tgz&quot;</span><span class="w"> </span>*
************************************************************************************************************************************

Saving<span class="w"> </span>mylib/0.1:<span class="w"> </span>mylib4abd06a04bdaa
Saving<span class="w"> </span>mylib/0.1:8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe:<span class="w"> </span>b/mylib503035e4ee8ae/p
Saving<span class="w"> </span>mylib/0.1:8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe<span class="w"> </span>metadata:<span class="w"> </span>b/mylib503035e4ee8ae/d/metadata
Local<span class="w"> </span>Cache
mylib
<span class="w">    </span>mylib/0.1
<span class="w">    </span>revisions
<span class="w">        </span>8760bf5a311f01cc26f3b95428203210<span class="w"> </span><span class="o">(</span><span class="m">2024</span>-07-08<span class="w"> </span><span class="m">12</span>:22:20<span class="w"> </span>UTC<span class="o">)</span>
<span class="w">        </span>packages
<span class="w">            </span>8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe
<span class="w">            </span>revisions
<span class="w">                </span>ded6547554ff2306db5250451340fa43
<span class="w">                </span>package_folder:<span class="w"> </span>b/mylib503035e4ee8ae/p
<span class="w">                </span>metadata_folder:<span class="w"> </span>b/mylib503035e4ee8ae/d/metadata
<span class="w">            </span>info
<span class="w">                </span>settings
<span class="w">                </span>os:<span class="w"> </span>Linux
<span class="w">                </span>arch:<span class="w"> </span>x86_64
<span class="w">                </span>compiler:<span class="w"> </span>gcc
<span class="w">                </span>compiler.cppstd:<span class="w"> </span>gnu17
<span class="w">                </span>compiler.libcxx:<span class="w"> </span>libstdc++11
<span class="w">                </span>compiler.version:<span class="w"> </span><span class="m">11</span>
<span class="w">                </span>build_type:<span class="w"> </span>Release
<span class="w">                </span>options
<span class="w">                </span>fPIC:<span class="w"> </span>True
<span class="w">                </span>shared:<span class="w"> </span>False
<span class="w">        </span>recipe_folder:<span class="w"> </span>mylib4abd06a04bdaa


******************************************************************************************
*<span class="w"> </span>Restore<span class="w"> </span>host<span class="w"> </span>cache<span class="w"> </span>from:<span class="w"> </span>&lt;/my/runner/folder&gt;/mylib/.conanrunner/docker_cache_save.tgz<span class="w">  </span>*
******************************************************************************************

Restore:<span class="w"> </span>mylib/0.1<span class="w"> </span><span class="k">in</span><span class="w"> </span>mylib4abd06a04bdaa
Restore:<span class="w"> </span>mylib/0.1:8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe<span class="w"> </span><span class="k">in</span><span class="w"> </span>b/mylib503035e4ee8ae/p
Restore:<span class="w"> </span>mylib/0.1:8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe<span class="w"> </span>metadata<span class="w"> </span><span class="k">in</span><span class="w"> </span>b/mylib503035e4ee8ae/d/metadata

**********************
*<span class="w"> </span>Stopping<span class="w"> </span>container<span class="w"> </span>*
**********************


**********************
*<span class="w"> </span>Removing<span class="w"> </span>container<span class="w"> </span>*
**********************
</pre></div>
</div>
<p>If we now check the status of our conan and docker cache, we will see the new mylib package compile for Linux and the new docker image but we don’t have any container because we define <code class="docutils literal notranslate"><span class="pre">remove=true</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>list<span class="w"> </span><span class="s2">&quot;*:*&quot;</span>
Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>pkg/version<span class="w"> </span>recipes<span class="w"> </span>matching<span class="w"> </span>*<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">local</span><span class="w"> </span>cache
Local<span class="w"> </span>Cache
mylib
<span class="w">    </span>mylib/0.1
<span class="w">    </span>revisions
<span class="w">        </span>8760bf5a311f01cc26f3b95428203210<span class="w"> </span><span class="o">(</span><span class="m">2024</span>-07-08<span class="w"> </span><span class="m">12</span>:33:28<span class="w"> </span>UTC<span class="o">)</span>
<span class="w">        </span>packages
<span class="w">            </span>8631cf963dbbb4d7a378a64a6fd1dc57558bc2fe
<span class="w">            </span>info
<span class="w">                </span>settings
<span class="w">                </span>arch:<span class="w"> </span>x86_64
<span class="w">                </span>build_type:<span class="w"> </span>Release
<span class="w">                </span>compiler:<span class="w"> </span>gcc
<span class="w">                </span>compiler.cppstd:<span class="w"> </span>gnu17
<span class="w">                </span>compiler.libcxx:<span class="w"> </span>libstdc++11
<span class="w">                </span>compiler.version:<span class="w"> </span><span class="m">11</span>
<span class="w">                </span>os:<span class="w"> </span>Linux
<span class="w">                </span>options
<span class="w">                </span>fPIC:<span class="w"> </span>True
<span class="w">                </span>shared:<span class="w"> </span>False
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span>--all
CONTAINER<span class="w"> </span>ID<span class="w">   </span>IMAGE<span class="w">     </span>COMMAND<span class="w">   </span>CREATED<span class="w">   </span>STATUS<span class="w">    </span>PORTS<span class="w">     </span>NAMES
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>docker<span class="w"> </span>images
REPOSITORY<span class="w">        </span>TAG<span class="w">       </span>IMAGE<span class="w"> </span>ID<span class="w">       </span>CREATED<span class="w">          </span>SIZE
my-conan-runner<span class="w">   </span>latest<span class="w">    </span>2bcf70201cce<span class="w">   </span><span class="m">11</span><span class="w"> </span>minutes<span class="w"> </span>ago<span class="w">   </span>531MB
</pre></div>
</div>
<p>What we have just done is to compile a library from scratch inside a Docker container without running any Docker command and retrieve the generated packages in a totally transparent and easily debuggable way thanks to our terminal output.</p>
<p>In this way, we can work as we have always done regardless of whether it is on our machine or in a container, without several open terminals and having the result of each operation in the same cache, being able to reuse the compiled packages from a previous compilation in another container automatically and transparently.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../runners.html" class="btn btn-neutral float-left" title="Conan runners examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configfile_build_args.html" class="btn btn-neutral float-right" title="Using a docker runner configfile to parameterize a Dockerfile" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最后更新于 10月 28, 2025.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>