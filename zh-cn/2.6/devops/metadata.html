<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Managing package metadata files &mdash; conan 2.6.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/devops/metadata.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=44300d06"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Versioning" href="versioning.html" />
    <link rel="prev" title="Creating an Artifactory backup repo for your sources" href="backup_sources/repositories/artifactory/creating_backup_sources_repo.html" />


 



</script>
<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../devops.html">Devops guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="using_conancenter.html">Using ConanCenter packages in production environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="devops_local_recipes_index.html">Local Recipes Index Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_sources/sources_backup.html">Backing up third-party sources with Conan</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Managing package metadata files</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning.html">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="save_restore.html">Save and restore packages from/to the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="vendoring.html">Vendoring dependencies in Conan packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../devops.html">Devops guide</a></li>
      <li class="breadcrumb-item active">Managing package metadata files</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/devops/metadata.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="managing-package-metadata-files">
<span id="devops-metadata"></span><h1>Managing package metadata files<a class="headerlink" href="#managing-package-metadata-files" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This feature is experimental and subject to breaking changes.
See <a class="reference internal" href="../introduction.html#stability"><span class="std std-ref">the Conan stability</span></a> section for more information.</p>
</div>
<p>A Conan package is typically composed by several C and C++ artifacts, headers, compiled libraries and executables. But there are other files that might not be necessary for the normal consumption of such a package, but which could be very important for compliance, technical or business reasons, for example:</p>
<ul class="simple">
<li><p>完整的构建日志</p></li>
<li><p>测试可执行文件</p></li>
<li><p>The tests results from running the test suite</p></li>
<li><p>Debugging artifacts like heavy .pdb files</p></li>
<li><p>Coverage, sanitizers, or other source or binary analysis tools results</p></li>
<li><p>Context and metadata about the build, exact machine, environment, author, CI data</p></li>
<li><p>Other compliance and security related files</p></li>
</ul>
<p>There are several important reasons to store and track these files like regulations, compliance, security, reproducibility and traceability.
The problem with these files is that they can be large/heavy, if we store them inside the package (just copying the artifacts in the <code class="docutils literal notranslate"><span class="pre">package()</span></code> method), this will make the packages much larger, and it will affect the speed of downloading, unzipping and using packages in general. And this typically happens a lot of times, both in developer machines but also in CI, and it can have an impact on the developer experience and infrastructure costs. Furthermore, packages are immutable, that is, once a package has been created, it shouldn’t be modified. This might be a problem if we want to add extra metadata files after the package has been created, or even after the package has been uploaded.</p>
<p>The <strong>metadata files</strong> feature allows to create, upload, append and store metadata associated to packages in an integrated and unified way, while avoiding the impact on developers and CI speed and costs, because metadata files are not downloaded and unzipped by default when packages are used.</p>
<p>It is important to highlight that there are two types of metadata:</p>
<ul class="simple">
<li><p>Recipe metadata, associated to the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> recipe, the metadata should be common to all binaries created from this recipe (package name, version and recipe revision). This metadata will probably be less common, but for example results of some scanning of the source code, that would be common for all configurations and builds, can be recipe metadata.</p></li>
<li><p>Package binary metadata, associated to the package binary for a given specific configuration and represented by a <code class="docutils literal notranslate"><span class="pre">package_id</span></code>. Build logs, tests reports, etc, that are specific to a binary configuration will be package metadata.</p></li>
</ul>
<section id="creating-metadata-in-recipes">
<h2>Creating metadata in recipes<a class="headerlink" href="#creating-metadata-in-recipes" title="Link to this heading">¶</a></h2>
<p>Recipes can directly define metadata in their methods. A common use case would be to store logs.
Using the <code class="docutils literal notranslate"><span class="pre">self.recipe_metadata_folder</span></code> and <code class="docutils literal notranslate"><span class="pre">self.package_metadata_folder</span></code>, the recipe can store files
in those locations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">save</span><span class="p">,</span> <span class="n">copy</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pkg</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
   <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pkg&quot;</span>
   <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># Or something else, like the &quot;cmake_layout(self)&quot; built-in layout</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="s2">&quot;mybuild&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;mybuild/generators&quot;</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># logs that might be generated in the recipe folder at &quot;export&quot; time.</span>
      <span class="c1"># these would be associated with the recipe repo and original source of the recipe repo</span>
      <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;*.log&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recipe_folder</span><span class="p">,</span>
           <span class="n">dst</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recipe_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># logs originated in the source() step, for example downloading files, patches or other stuff</span>
      <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recipe_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="s2">&quot;src.log&quot;</span><span class="p">),</span> <span class="s2">&quot;srclog!!&quot;</span><span class="p">)</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># logs originated at build() step, the most common ones</span>
      <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mylogs.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;some logs!!!&quot;</span><span class="p">)</span>
      <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mylogs.txt&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">build_folder</span><span class="p">,</span>
           <span class="n">dst</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that “recipe” methods (those that are common for all binaries, like <code class="docutils literal notranslate"><span class="pre">export()</span></code> and <code class="docutils literal notranslate"><span class="pre">source()</span></code>) should use
<code class="docutils literal notranslate"><span class="pre">self.recipe_metadata_folder</span></code>, while “package” specific methods (<code class="docutils literal notranslate"><span class="pre">build()</span></code>, <code class="docutils literal notranslate"><span class="pre">package()</span></code>) should use the
<code class="docutils literal notranslate"><span class="pre">self.package_metadata_folder</span></code>.</p>
<p>Doing a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> over this recipe, will create “metadata” folders in the Conan cache. We can have a look at those folders with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># folder containing the recipe metadata</span>
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1:package_id<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># folder containing the specific &quot;package_id&quot; binary metadata</span>
</pre></div>
</div>
<p>It is also possible to use the “local flow” commands and get local “metadata” folders. If we want to do this, it is very recommended
to use a <code class="docutils literal notranslate"><span class="pre">layout()</span></code> method like above to avoid cluttering the current folder. Then the local commands will allow to test and debug the functionality:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span><span class="nb">source</span><span class="w"> </span>.
<span class="c1"># check local metadata/logs/src.log file</span>
$<span class="w"> </span>conan<span class="w"> </span>build<span class="w"> </span>.
<span class="c1"># check local mybuild/metadata/logs/mylogs.txt file</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: This metadata is not valid for the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">export-pkg</span></code> flow. If you want to use the <code class="docutils literal notranslate"><span class="pre">export-pkg</span></code> flow you might want to check the
“Adding metadata” section below.</p>
</section>
<section id="creating-metadata-with-hooks">
<h2>Creating metadata with hooks<a class="headerlink" href="#creating-metadata-with-hooks" title="Link to this heading">¶</a></h2>
<p>If there is some common metadata accross recipes, it is possible to capture it without modifying the recipes, using hooks.
Let’s say that we have a simpler recipe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">save</span><span class="p">,</span> <span class="n">copy</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pkg</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
   <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pkg&quot;</span>
   <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
   <span class="n">no_copy_source</span> <span class="o">=</span> <span class="kc">True</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="s2">&quot;mybuild&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;mybuild/generators&quot;</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;logs/src.log&quot;</span><span class="p">,</span> <span class="s2">&quot;srclog!!&quot;</span><span class="p">)</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;logs/mylogs.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;some logs!!!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As we can see, this is not using the metadata folders at all.
Let’s define now the following hooks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">post_export</span><span class="p">(</span><span class="n">conanfile</span><span class="p">):</span>
      <span class="n">conanfile</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;post_export&quot;</span><span class="p">)</span>
      <span class="n">copy</span><span class="p">(</span><span class="n">conanfile</span><span class="p">,</span> <span class="s2">&quot;*.log&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">conanfile</span><span class="o">.</span><span class="n">recipe_folder</span><span class="p">,</span>
         <span class="n">dst</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">recipe_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">post_source</span><span class="p">(</span><span class="n">conanfile</span><span class="p">):</span>
      <span class="n">conanfile</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;post_source&quot;</span><span class="p">)</span>
      <span class="n">copy</span><span class="p">(</span><span class="n">conanfile</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">),</span>
         <span class="n">dst</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">recipe_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">post_build</span><span class="p">(</span><span class="n">conanfile</span><span class="p">):</span>
      <span class="n">conanfile</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;post_build&quot;</span><span class="p">)</span>
      <span class="n">copy</span><span class="p">(</span><span class="n">conanfile</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">build_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">),</span>
         <span class="n">dst</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">package_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The usage of these hooks will have a very similar effect to the in-recipe approach: the metadata files
will be created in the cache when <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> executes, and also locally for the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">build</span></code>
local flow.</p>
</section>
<section id="adding-metadata-with-commands">
<h2>Adding metadata with commands<a class="headerlink" href="#adding-metadata-with-commands" title="Link to this heading">¶</a></h2>
<p>Metadata files can be added or modified after the package has been created. To achieve this, using the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">cache</span> <span class="pre">path</span></code>
command will return the folders to do that operation, so copying, creating or modifying files in that location will achieve this.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>--name<span class="o">=</span>pkg<span class="w"> </span>--version<span class="o">=</span><span class="m">0</span>.1
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># folder to put the metadata, initially empty if we didn&#39;t use hooks</span>
<span class="c1"># and the recipe didn&#39;t store any metadata. We can copy and put files</span>
<span class="c1"># in the folder</span>
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1:package_id<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># same as above, for the package metadata, we can copy and put files in</span>
<span class="c1"># the returned folder</span>
</pre></div>
</div>
<p>This metadata is added locally, in the Conan cache. If you want to update the server metadata, uploading it from the cache is necessary.</p>
</section>
<section id="uploading-metadata">
<h2>Uploading metadata<a class="headerlink" href="#uploading-metadata" title="Link to this heading">¶</a></h2>
<p>So far the metadata has been created locally, stored in the Conan cache. Uploading the metadata to the server is integrated with
the existing <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">upload</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-c<span class="w"> </span>-r<span class="o">=</span>default
<span class="c1"># Uploads recipes, packages and metadata to the &quot;default&quot; remote</span>
...
pkg/0.1:<span class="w"> </span>Recipe<span class="w"> </span>metadata:<span class="w"> </span><span class="m">1</span><span class="w"> </span>files
pkg/0.1:da39a3ee5e6b4b0d3255bfef95601890afd80709:<span class="w"> </span>Package<span class="w"> </span>metadata:<span class="w"> </span><span class="m">1</span><span class="w"> </span>files
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">upload</span></code> will upload recipes and packages metadata when a recipe or a package is uploaded to the server.
But there are some situations that Conan will completely avoid this upload, if it detects that the revisions do already exist
in the server, it will not upload the recipes or the packages.
If the metadata has been locally modified or added new files, we can force the upload explicitly with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># We added some metadata to the packages in the cache</span>
<span class="c1"># But those packages already exist in the server</span>
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-c<span class="w"> </span>-r<span class="o">=</span>default<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;*&quot;</span>
...
pkg/0.1:<span class="w"> </span>Recipe<span class="w"> </span>metadata:<span class="w"> </span><span class="m">1</span><span class="w"> </span>files
pkg/0.1:da39a3ee5e6b4b0d3255bfef95601890afd80709:<span class="w"> </span>Package<span class="w"> </span>metadata:<span class="w"> </span><span class="m">1</span><span class="w"> </span>files
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--metadata</span></code> argument allows to specify the metadata files that we are uploading. If we structure them in folders,
we could specify <code class="docutils literal notranslate"><span class="pre">--metadata=&quot;logs*&quot;</span></code> to upload only the logs metadata, but not other possible ones like <code class="docutils literal notranslate"><span class="pre">test</span></code> metadata.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload only the logs metadata of the zlib/1.2.13 binaries</span>
<span class="c1"># This will upload the logs even if zlib/1.2.13 is already in the server</span>
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;zlib/1.2.13:*&quot;</span><span class="w"> </span>-r<span class="o">=</span>remote<span class="w"> </span>-c<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;logs/*&quot;</span>
<span class="c1"># Multiple patterns are allowed:</span>
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-r<span class="o">=</span>remote<span class="w"> </span>-c<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;logs/*&quot;</span><span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;tests/*&quot;</span>
</pre></div>
</div>
<p>Sometimes it might be useful to upload packages without uploading the metadata, even if the metadata cache folders contain files.
To ignore uploading the metadata, use an empty argument as metadata pattern:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload only the packages, not the metadata</span>
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-r<span class="o">=</span>remote<span class="w"> </span>-c<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>The case of mixing <code class="docutils literal notranslate"><span class="pre">--metadata=&quot;&quot;</span></code> with <code class="docutils literal notranslate"><span class="pre">--metadata=&quot;*&quot;</span></code> is not allowed, and it will raise an error.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Invalid command, it will raise an error</span>
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-r<span class="o">=</span>remote<span class="w"> </span>-c<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;logs/*&quot;</span>
ERROR:<span class="w"> </span>Empty<span class="w"> </span>string<span class="w"> </span>and<span class="w"> </span>patterns<span class="w"> </span>can<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>mixed<span class="w"> </span><span class="k">for</span><span class="w"> </span>metadata.
</pre></div>
</div>
</section>
<section id="downloading-metadata">
<h2>Downloading metadata<a class="headerlink" href="#downloading-metadata" title="Link to this heading">¶</a></h2>
<p>As described above, metadata is not downloaded by default. When packages are downloaded with a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> or <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code>
fetching dependencies from the servers, the metadata from those servers will not be downloaded.</p>
<p>The way to recover the metadata from the server is to explicitly specify it with the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">download</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the metadata of the &quot;pkg/0.1&quot; package</span>
$<span class="w"> </span>conan<span class="w"> </span>download<span class="w"> </span>pkg/0.1<span class="w"> </span>-r<span class="o">=</span>default<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;*&quot;</span>
...
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># Inspect the recipe metadata in the returned folder</span>
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1:package_id<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># Inspect the package metadata for binary &quot;package_id&quot;</span>
</pre></div>
</div>
<p>The retrieval of the metadata is done with <code class="docutils literal notranslate"><span class="pre">download</span></code> per-package. If we want to download the metadata for a whole dependency graph, it is necessary to use “package-lists”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>-r<span class="o">=</span>remote<span class="w"> </span>&gt;<span class="w"> </span>graph.json
$<span class="w"> </span>conan<span class="w"> </span>list<span class="w"> </span>--graph<span class="o">=</span>graph.json<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>pkglist.json
<span class="c1"># the list will contain the &quot;remote&quot; origin of downloaded packages</span>
$<span class="w"> </span>conan<span class="w"> </span>download<span class="w"> </span>--list<span class="o">=</span>pkglist.json<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-r<span class="o">=</span>remote
</pre></div>
</div>
<p>Note that the “package-list” will only contain associated to the “remote” origin the packages that were downloaded. If they were previously in the cache, then, they will not be listed under the “remote” origin and the metadata will not be downloaded. If you want to collect the dependencies metadata, recall to download it when the package is installed from the server.
There are other possibilities, like a custom command that can automatically collect and download dependencies metadata from the servers.</p>
</section>
<section id="removing-metadata">
<h2>Removing metadata<a class="headerlink" href="#removing-metadata" title="Link to this heading">¶</a></h2>
<p>At the moment it is not possible to remove metadata from the server side using Conan, as the metadata are “additive”, it is possible to add new data, but not to remove it (otherwise it would not be possible to add new metadata without downloading first all the previous metadata, and that can be quite inefficient and more error prone, specially sensitive to possible race conditions).</p>
<p>The recommendation to remove metatada from the server side would be to use the tools, web interface or APIs that the server might provide.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<blockquote>
<div><p><strong>Best practices</strong></p>
</div></blockquote>
<ul class="simple">
<li><p>Metadata shouldn’t be necessary for using packages. It should be possible to consume recipes and packages without downloading their
metadata. If metadata is mandatory for a package to be used, then it is not metadata and should be packaged as headers and binaries.</p></li>
<li><p>Metadata reading access should not be a frequent operation, or something that developers have to do. Metadata read is intended for
excepcional cases, when some build logs need to be recovered for compliance, or some test executables might be needed for debugging or
re-checking a crash.</p></li>
<li><p>Conan does not do any compression or decompression of the metadata files. If there are a lot of metadata files, consider zipping them yourself, otherwise the upload of those many files can take a lot of time. If you need to handle different types of metadata (logs, tests, reports), zipping the files under each category might be better to be able to filter with the <code class="docutils literal notranslate"><span class="pre">--metadata=xxx</span></code> argument.</p></li>
</ul>
</div>
</section>
<section id="test-package-as-metadata">
<h2>test_package as metadata<a class="headerlink" href="#test-package-as-metadata" title="Link to this heading">¶</a></h2>
<p>This is an illustrative example of usage of metadata, storing the full <code class="docutils literal notranslate"><span class="pre">test_package</span></code> folder as
metadata to later recover it and execute it. Note that this is not necessarily intended for production.</p>
<p>Let’s  start with a hook that automatically stores as <strong>recipe metadata</strong> the <code class="docutils literal notranslate"><span class="pre">test_package</span></code> folder</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">post_export</span><span class="p">(</span><span class="n">conanfile</span><span class="p">):</span>
   <span class="n">conanfile</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Storing test_package&quot;</span><span class="p">)</span>
   <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">recipe_folder</span><span class="p">,</span> <span class="s2">&quot;test_package&quot;</span><span class="p">)</span>
   <span class="n">copy</span><span class="p">(</span><span class="n">conanfile</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
         <span class="n">dst</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conanfile</span><span class="o">.</span><span class="n">recipe_metadata_folder</span><span class="p">,</span> <span class="s2">&quot;test_package&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this hook doesn’t take into account that <code class="docutils literal notranslate"><span class="pre">test_package</span></code> can be dirty with tons of temporary build
objects (it should be cleaned before being added to metadata), and it doesn’t check that <code class="docutils literal notranslate"><span class="pre">test_package</span></code> might
not exist at all and crash.</p>
<p>When a package is created and uploaded, it will upload to the server the recipe metadata containing the <code class="docutils literal notranslate"><span class="pre">test_package</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>...
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-c<span class="w"> </span>-r<span class="o">=</span>default<span class="w">  </span><span class="c1"># uploads metadata</span>
...
pkg/0.1:<span class="w"> </span>Recipe<span class="w"> </span>metadata:<span class="w"> </span><span class="m">1</span><span class="w"> </span>files
</pre></div>
</div>
<p>Let’s remove the local copy, and assume that the package is installed, but the metadata is not:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>remove<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-c<span class="w">  </span><span class="c1"># lets remove the local packages</span>
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>pkg/0.1<span class="w"> </span>-r<span class="o">=</span>default<span class="w">  </span><span class="c1"># this will not download metadata</span>
</pre></div>
</div>
<p>If at this stage the installed package is failing in our application, we could recover the <code class="docutils literal notranslate"><span class="pre">test_package</span></code>,
downloading it, and copying it to our current folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>download<span class="w"> </span>pkg/0.1<span class="w"> </span>-r<span class="o">=</span>default<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;test_package*&quot;</span>
$<span class="w"> </span>conan<span class="w"> </span>cache<span class="w"> </span>path<span class="w"> </span>pkg/0.1<span class="w"> </span>--folder<span class="o">=</span>metadata
<span class="c1"># copy the test_package folder from the cache, to the current folder</span>
<span class="c1"># like `cp -R ...`</span>

<span class="c1"># Execute the test_package</span>
$<span class="w"> </span>conan<span class="w"> </span><span class="nb">test</span><span class="w"> </span>metadata/test_package<span class="w"> </span>pkg/0.1
pkg/0.1<span class="w"> </span><span class="o">(</span><span class="nb">test</span><span class="w"> </span>package<span class="o">)</span>:<span class="w"> </span>Running<span class="w"> </span>test<span class="o">()</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<ul class="simple">
<li><p>TODO: Examples how to collect the metadata of a complete dependency graph with some custom deployer or command</p></li>
</ul>
</div>
<p>This is an <strong>experimental</strong> feature. We are looking forward to hearing your feedback, use cases and needs, to keep improving this feature. Please report it in <a class="reference external" href="https://github.com/conan-io/conan/issues">Github issues</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="backup_sources/repositories/artifactory/creating_backup_sources_repo.html" class="btn btn-neutral float-left" title="Creating an Artifactory backup repo for your sources" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="versioning.html" class="btn btn-neutral float-right" title="Versioning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最后更新于 2月 17, 2026.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>