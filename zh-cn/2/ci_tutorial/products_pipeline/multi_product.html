<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Products pipeline: multi-product multi-configuration builds &mdash; conan 2.25.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/ci_tutorial/products_pipeline/multi_product.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=65a55fc7"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Products pipeline: distributed full pipeline with lockfiles" href="full_pipeline.html" />
    <link rel="prev" title="Products pipeline: the build-order" href="build_order.html" />


 



</script>
<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">CI 教程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../project_setup.html">Project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages_pipeline.html">Packages pipeline</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../products_pipeline.html">Products pipeline</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="single_configuration.html">Products pipeline: single configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_order.html">Products pipeline: the build-order</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Products pipeline: multi-product multi-configuration builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="full_pipeline.html">Products pipeline: distributed full pipeline with lockfiles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/devops.html">Devops guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../incubating.html">Incubating features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorial.html">Continuous Integration (CI) tutorial</a></li>
          <li class="breadcrumb-item"><a href="../products_pipeline.html">Products pipeline</a></li>
      <li class="breadcrumb-item active">Products pipeline: multi-product multi-configuration builds</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/ci_tutorial/products_pipeline/multi_product.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="products-pipeline-multi-product-multi-configuration-builds">
<h1>Products pipeline: multi-product multi-configuration builds<a class="headerlink" href="#products-pipeline-multi-product-multi-configuration-builds" title="Link to this heading">¶</a></h1>
<p>In the previous section we computed a <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">build-order</span></code> with several simplifications, we didn’t take the <code class="docutils literal notranslate"><span class="pre">mapviewer</span></code> product into account, and we processed only 1 configuration.</p>
<p>In real scenarios, it will be necessary to manage more than one product and the most common case is that there is more than one configuration for every product. If we build these different cases sequentially it will be much slower and inefficient, and if we try to build them in parallel there will easily be many duplicated and unnecessary builds of the same packages, wasting resources and even producing issues as race conditions or traceability problems.</p>
<p>To avoid this issue, it is possible to compute a single unified “build-order” that aggregates all the different build-orders that are computed for the different products and configurations.</p>
<p>Let’s start as usual cleaning the local cache and defining the correct repos:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># First clean the local &quot;build&quot; folder</span>
$<span class="w"> </span><span class="nb">pwd</span><span class="w">  </span><span class="c1"># should be &lt;path&gt;/examples2/ci/game</span>
$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build<span class="w">  </span><span class="c1"># clean the temporary build folder</span>
$<span class="w"> </span>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build<span class="w"> </span><span class="c1"># To put temporary files</span>

$<span class="w"> </span>conan<span class="w"> </span>remove<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-c<span class="w">  </span><span class="c1"># Make sure no packages from last run</span>
<span class="c1"># NOTE: The products repo is first, it will have higher priority.</span>
$<span class="w"> </span>conan<span class="w"> </span>remote<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>products
</pre></div>
</div>
<p>Now, we will start computing the build-order for <code class="docutils literal notranslate"><span class="pre">game/1.0</span></code> for the 2 different configurations that we are building in this tutorial, debug and release:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>--requires<span class="o">=</span>game/1.0<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>--order-by<span class="o">=</span>recipe<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>game_release.json
$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>--requires<span class="o">=</span>game/1.0<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>--order-by<span class="o">=</span>recipe<span class="w"> </span>-s<span class="w"> </span><span class="nv">build_type</span><span class="o">=</span>Debug<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>game_debug.json
</pre></div>
</div>
<p>These commands are basically the same as in the previous section, each one with a different configuration and creating a different output file <code class="docutils literal notranslate"><span class="pre">game_release.json</span></code> and <code class="docutils literal notranslate"><span class="pre">game_debug.json</span></code>. These files will be similar to the previous ones, but as we haven’t used the <code class="docutils literal notranslate"><span class="pre">--reduce</span></code> argument (this is important!) they will actually contain a “build-order” of all elements in the graph, even if only some contain the <code class="docutils literal notranslate"><span class="pre">binary:</span> <span class="pre">Build</span></code> definition, and others will contain other <code class="docutils literal notranslate"><span class="pre">binary:</span> <span class="pre">Download|Cache|etc</span></code>.</p>
<p>Now, let’s compute the build-order for <code class="docutils literal notranslate"><span class="pre">mapviewer/1.0</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>--requires<span class="o">=</span>mapviewer/1.0<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>--order-by<span class="o">=</span>recipe<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>mapviewer_release.json
$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>--requires<span class="o">=</span>mapviewer/1.0<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>--order-by<span class="o">=</span>recipe<span class="w"> </span>-s<span class="w"> </span><span class="nv">build_type</span><span class="o">=</span>Debug<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>mapviewer_debug.json
</pre></div>
</div>
<p>Note that in the generated <code class="docutils literal notranslate"><span class="pre">mapviewer_xxx.json</span></code> build-order files, there will be only 1 element for <code class="docutils literal notranslate"><span class="pre">mapviewer/1.0</span></code> that contains a <code class="docutils literal notranslate"><span class="pre">binary:</span> <span class="pre">Download</span></code>, because there is really no other package to be built, and as <code class="docutils literal notranslate"><span class="pre">mapviewer</span></code> is an application linked statically, Conan knows that it can “skip” its dependencies binaries. If we had used the <code class="docutils literal notranslate"><span class="pre">--reduce</span></code> argument we would have obtained an empty <code class="docutils literal notranslate"><span class="pre">order</span></code>. But this is not an issue, as the next final step will really compute what needs to be built.</p>
<p>Let’s take all the 4 different “build-order” files (2 products x 2 configurations each), and merge them together:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order-merge<span class="w"> </span>--file<span class="o">=</span>game_release.json<span class="w"> </span>--file<span class="o">=</span>game_debug.json<span class="w"> </span>--file<span class="o">=</span>mapviewer_release.json<span class="w"> </span>--file<span class="o">=</span>mapviewer_debug.json<span class="w"> </span>--reduce<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>build_order.json
</pre></div>
</div>
<p>Now we have applied the <code class="docutils literal notranslate"><span class="pre">--reduce</span></code> argument to produce a final <code class="docutils literal notranslate"><span class="pre">build_order.json</span></code> that is ready for distribution to the build agents and it only contains those specific packages that need to be built:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;order_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;recipe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;reduced&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;engine/1.0#fba6659c9dd04a4bbdc7a375f22143cb&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;packages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;de738ff5d09f0359b81da17c58256c619814a765&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;filenames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;game_release&quot;</span><span class="p">],</span>
<span class="w">                            </span><span class="nt">&quot;build_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--requires=engine/1.0 --build=engine/1.0&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cbeb3ac76e3d890c630dae5c068bc178e538b090&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;filenames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;game_debug&quot;</span><span class="p">],</span>
<span class="w">                            </span><span class="nt">&quot;build_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--requires=engine/1.0 --build=engine/1.0&quot;</span><span class="p">,</span>

<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;game/1.0#1715574045610faa2705017c71d0000e&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;packages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bac7cd2fe1592075ddc715563984bbe000059d4c&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;filenames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;game_release&quot;</span><span class="p">],</span>
<span class="w">                            </span><span class="nt">&quot;build_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--requires=game/1.0 --build=game/1.0&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01fbc27d2c156886244dafd0804eef1fff13440b&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="nt">&quot;filenames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;game_debug&quot;</span><span class="p">],</span>
<span class="w">                            </span><span class="nt">&quot;build_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--requires=game/1.0 --build=game/1.0&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;profiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;game_release&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;game_debug&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-s:h=\&quot;build_type=Debug\&quot;&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;mapviewer_release&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;mapviewer_debug&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-s:h=\&quot;build_type=Debug\&quot;&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This build order summarizes the necessary builds. First it is necessary to build all different binaries for <code class="docutils literal notranslate"><span class="pre">engine/1.0</span></code>. This recipe contains 2 different binaries, one for Release and the other for Debug. These binaries belong to the same element in the <code class="docutils literal notranslate"><span class="pre">packages</span></code> list, which means they do not depend on each other and can be built in parallel. Each binary tracks its own original build-order file with <code class="docutils literal notranslate"><span class="pre">&quot;filenames&quot;:</span> <span class="pre">[&quot;game_release&quot;],</span></code> so it is possible to deduce the necessary profiles to apply to it. The <code class="docutils literal notranslate"><span class="pre">build_order.json</span></code> file contains a <code class="docutils literal notranslate"><span class="pre">profiles</span></code> section that helps recovering the profile and settings command line arguments that were used to create the respective original build-order files.</p>
<p>Then, after all binaries of <code class="docutils literal notranslate"><span class="pre">engine/1.0</span></code> have been built, it is possible to proceed to build the different binaries for <code class="docutils literal notranslate"><span class="pre">game/1.0</span></code>. It also contains 2 different binaries for its debug and release configurations, which can be built in parallel.</p>
<p>In practice, this would mean something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This 2 could be executed in parallel</span>
<span class="c1"># (in different machines, or different Conan caches)</span>
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>engine/1.0<span class="w"> </span>--build<span class="o">=</span>engine/1.0
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>engine/1.0<span class="w"> </span>--build<span class="o">=</span>engine/1.0<span class="w"> </span>-s<span class="w"> </span><span class="nv">build_type</span><span class="o">=</span>Debug

<span class="c1"># Once engine/1.0 builds finish, it is possible</span>
<span class="c1"># to build these 2 binaries in parallel (in different machines or caches)</span>
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>game/1.0<span class="w"> </span>--build<span class="o">=</span>game/1.0
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>game/1.0<span class="w"> </span>--build<span class="o">=</span>game/1.0<span class="w"> </span>-s<span class="w"> </span><span class="nv">build_type</span><span class="o">=</span>Debug
</pre></div>
</div>
<p>In this section we have still omitted some important implementation details that will follow in next sections. The goal was to focus on the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">build-order-merge</span></code> command and how different products and configurations can be merged in a single “build-order”. The next section will show with more details how this build-order can be really distributed in CI, using lockfiles to guarantee constant dependencies.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build_order.html" class="btn btn-neutral float-left" title="Products pipeline: the build-order" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="full_pipeline.html" class="btn btn-neutral float-right" title="Products pipeline: distributed full pipeline with lockfiles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2026, JFrog.
      <span class="lastupdated">最后更新于 2月 17, 2026.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>