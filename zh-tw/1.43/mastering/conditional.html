



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conditional settings, options and requirements &mdash; conan 1.43.4 說明文件</title>
  

  
  
    <link rel="shortcut icon" href="../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../_static/css/search.css" type="text/css" />
        <link rel="index" title="索引"
              href="../genindex.html"/>
        <link rel="search" title="搜尋" href="../search.html"/>
    <link rel="top" title="conan 1.43.4 說明文件" href="../index.html"/>
        <link rel="up" title="精通 Conan" href="../mastering.html"/>
        <link rel="next" title="Build policies" href="policies.html"/>
        <link rel="prev" title="Use conanfile.py for consumers" href="conanfile_py.html"/>


 



</script>
<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://conan.io">
          

          
            
            <img src="../_static/conan-logo.png" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training_courses.html">Training Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_packages.html">Creating Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uploading_packages.html">上傳軟體包</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing_packages.html">Developing packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versioning.html">Versioning</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../mastering.html">精通 Conan</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conanfile_py.html">Use conanfile.py for consumers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Conditional settings, options and requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constrain-settings-and-options">Constrain settings and options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="policies.html">Build policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="envvars.html">環境變數</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtualenv.html">Virtual Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing_settings_and_config.html">Sharing the settings and other configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_cache.html">Conan local cache: concurrency, Continuous Integration, isolation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">Extending Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">Howtos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">變更日誌</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conan_v2.html">Conan migration guide to 2.0</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p>Sign up for release updates:</p>
              <script src="https://app-lon04.marketo.com/js/forms2/js/forms2.min.js"></script>
              <form id="mktoForm_1479"></form>
              <script>MktoForms2.loadForm("https://app-lon04.marketo.com", "256-FNZ-187", 1479);</script>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../mastering.html">精通 Conan</a> &raquo;</li>
        
      <li>Conditional settings, options and requirements</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/master/mastering/conditional.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>JFrog Bintray is being sunset. <a
            href=https://blog.conan.io/2021/03/31/Bintray-sunset-timeline.html> Please refer this blog post for more detail.</a>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="conditional-settings-options-and-requirements">
<span id="conditional-settings-options-requirements"></span><h1>Conditional settings, options and requirements<a class="headerlink" href="#conditional-settings-options-and-requirements" title="本標題的永久連結">¶</a></h1>
<p>Remember, in your <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> you can use the value of your options to:</p>
<ul class="simple">
<li>Add requirements dynamically</li>
<li>Change values of other options</li>
<li>Assign values to options of your requirements</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">configure()</span></code> method might be used to hardcoded values for options of the requirements.
It is strongly discouraged to use it to change the settings values. Please remember that <code class="docutils literal notranslate"><span class="pre">settings</span></code>
are a configuration <em>input</em>, so it doesn’t make sense to modify it in the recipes.</p>
<p>Also, for options, a more flexible solution is to define dependencies options values in the <code class="docutils literal notranslate"><span class="pre">default_options</span></code>,
not in the <code class="docutils literal notranslate"><span class="pre">configure()</span></code> method. Setting the values in <code class="docutils literal notranslate"><span class="pre">configure()</span></code> won’t allow to override them and it
will make really hard (even impossible) to resolve some conflicts. Use it only when it is absolutely
necessary that the package dependencies use those options.</p>
<p>Here is an example of what we could do in our <strong>configure method</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Recipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="n">requires</span> <span class="o">=</span> <span class="s2">&quot;poco/1.9.4&quot;</span> <span class="c1"># We will add OpenSSL dynamically &quot;openssl/1.0.2t&quot;</span>
  <span class="o">...</span>

  <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># We can control the options of our dependencies based on current options</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;openssl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">shared</span>

      <span class="c1"># Maybe in windows we know that OpenSSL works better as shared (false)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;openssl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="kc">True</span>

         <span class="c1"># Or adjust any other available option</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;poco&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">other_option</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>

      <span class="c1"># We could check the presence of an option</span>
      <span class="k">if</span> <span class="s2">&quot;shared&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
          <span class="k">pass</span>

  <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># Or add a new requirement!</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">testing</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;OpenSSL/2.1@memsharded/testing&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;openssl/1.0.2u&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># We can check the final values of options of our requirements</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;poco&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">that_option</span> <span class="o">!=</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">ConanInvalidConfiguration</span><span class="p">(</span><span class="s2">&quot;Who modified this option?!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="constrain-settings-and-options">
<h2>Constrain settings and options<a class="headerlink" href="#constrain-settings-and-options" title="本標題的永久連結">¶</a></h2>
<p>Sometimes there are libraries that are not compatible with specific settings like libraries
that are not compatible with an architecture, or options that only make sense for an operating system. It can also be useful when there are
settings under development.</p>
<p>There are two approaches for this situation:</p>
<ul>
<li><p class="first"><strong>Use</strong> <code class="docutils literal notranslate"><span class="pre">validate()</span></code> <strong>to raise an error for non-supported configurations</strong>:</p>
<p>This approach is the first one evaluated when Conan loads the recipe so it is quite handy to perform checks of the input settings. It
relies on the set of possible settings inside your <em>settings.yml</em> file, so it can be used to constrain any recipe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans.errors</span> <span class="kn">import</span> <span class="n">ConanInvalidConfiguration</span>
<span class="o">...</span>
<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">ConanInvalidConfiguration</span><span class="p">(</span><span class="s2">&quot;This library is not compatible with Windows&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小訣竅</p>
<p class="last">Use the <a class="reference internal" href="../reference/conanfile/methods.html#invalid-configuration"><span class="std std-ref">Invalid configuration</span></a> exception to make Conan return with a special error code. This will indicate that the
configuration used for settings or options is not supported.</p>
</div>
<p>This same method is also valid for <code class="docutils literal notranslate"><span class="pre">options</span></code> and <code class="docutils literal notranslate"><span class="pre">config_options()</span></code> method and it is commonly used to remove options for one setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">config_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fPIC</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">備註</p>
<p class="last">For managing invalid configurations, please check the new experimental <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method (<a class="reference internal" href="../reference/conanfile/methods.html#method-validate"><span class="std std-ref">validate()</span></a>).</p>
</div>
<ul>
<li><p class="first"><strong>Constrain settings inside a recipe</strong>:</p>
<p>This approach constrains the settings inside a recipe to a subset of them, and it is normally used in recipes that are never supposed to
work out of the restricted settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conans</span> <span class="kn">import</span> <span class="n">ConanFile</span>

<span class="k">class</span> <span class="nc">MyConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;myconanlibrary&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0.0&quot;</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;x86_64&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>The disadvantage of this is that possible settings are hardcoded in the recipe, and in case new values are used in the future, it will
require the recipe to be modified explicitly.</p>
<div class="admonition important">
<p class="first admonition-title">重要</p>
<p class="last">Note: the use of the <code class="docutils literal notranslate"><span class="pre">None</span></code> value in the <code class="docutils literal notranslate"><span class="pre">os</span></code>, <code class="docutils literal notranslate"><span class="pre">compiler</span></code> and <code class="docutils literal notranslate"><span class="pre">build_type</span></code> settings described above will allow them to take the values
from <em>settings.yml</em> file</p>
</div>
</li>
</ul>
<p>We strongly recommend the use of the first approach whenever it is possible, and use the second one only for those cases where a stronger
constrain is needed for a particular recipe.</p>
<div class="admonition seealso">
<p class="first admonition-title">也參考</p>
<p class="last">Check the reference section <a class="reference internal" href="../reference/conanfile/methods.html#method-configure-config-options"><span class="std std-ref">configure(), config_options()</span></a> to find out more.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="policies.html" class="btn btn-neutral float-right" title="Build policies" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="conanfile_py.html" class="btn btn-neutral" title="Use conanfile.py for consumers" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2021, JFrog.
      最後更新於 10月 27, 2025。
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.43.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../_static/js/modernizr.min.js"></script>
  <script src="../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("1.43");
  </script>


 


</body>
</html>