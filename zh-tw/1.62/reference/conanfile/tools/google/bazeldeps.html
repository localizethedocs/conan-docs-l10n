



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BazelDeps &mdash; conan 1.62.0 說明文件</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../../../_static/css/search.css" type="text/css" />
        <link rel="index" title="索引"
              href="../../../../genindex.html"/>
        <link rel="search" title="搜尋" href="../../../../search.html"/>
    <link rel="top" title="conan 1.62.0 說明文件" href="../../../../index.html"/>
        <link rel="up" title="conan.tools.google" href="../google.html"/>
        <link rel="next" title="BazelToolchain" href="bazeltoolchain.html"/>
        <link rel="prev" title="conan.tools.google" href="../google.html"/>


 



</script>
<script type="text/javascript" src="../../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../../ltd-flyout.js"></script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="../../../../_static/conan-logo.png" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../conan_v2.html">Conan migration guide to 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../training_courses.html">Training Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_packages.html">Using packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../creating_packages.html">Creating Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../uploading_packages.html">上傳軟體包</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developing_packages.html">Developing packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devtools.html">Package apps and devtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mastering.html">精通 Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../systems_cross_building.html">Systems and cross building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extending.html">Extending Conan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../howtos.html">Howtos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../reference.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../commands.html">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../conanfile_txt.html">conanfile.txt</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../conanfile.html">conanfile.py</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../attributes.html">Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../methods.html">Methods</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../tools.html">tools</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../cmake.html">conan.tools.cmake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../gnu.html">conan.tools.gnu</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../google.html">conan.tools.google</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apple.html">conan.tools.apple</a></li>
<li class="toctree-l4"><a class="reference internal" href="../meson.html">conan.tools.meson</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel.html">conan.tools.intel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../microsoft.html">conan.tools.microsoft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../qbs.html">conan.tools.qbs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../env.html">conan.tools.env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../system.html">conan.tools.system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../files.html">conan.tools.files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../layout.html">conan.tools.layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scm.html">conan.tools.scm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build.html">conan.tools.build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../android.html">conan.tools.android</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scons.html">conan.tools.scons</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dependencies.html">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../other.html">Python requires</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../other.html#output-and-running">Output and Running</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../generators.html">生成器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html">Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../build_helpers.html">Build helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_files.html">Configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../env_vars.html">環境變數</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hooks.html">Hooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../videos.html">Videos and links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">變更日誌</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p><a href="https://conan.io/#signUp" target="_blank">Sign up for release updates</a></p>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../../../../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div class="admonition warning wy-text-center">
            <p>This document is for a <b>"1.X" legacy</b> Conan version. <a href="https://docs.conan.io/2/">Click here to read the <b>Conan 2.0</b> documentation</a></p>
          </div>
                 
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../reference.html">Reference</a> &raquo;</li>
        
          <li><a href="../../../conanfile.html">conanfile.py</a> &raquo;</li>
        
          <li><a href="../../tools.html">tools</a> &raquo;</li>
        
          <li><a href="../google.html">conan.tools.google</a> &raquo;</li>
        
      <li>BazelDeps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/master/reference/conanfile/tools/google/bazeldeps.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>Recipe Hacking no. 2! Building on what we learnt during the first installment we will be working on more Conan 2.0 Migration! We'll start by reviewing some open pull requests and hopefully tackle a CMake example. <a
            href=https://jfrog.zoom.us/webinar/register/WN_grFhqH0yRBeIfJmBvQoPJw> Register here to attend.</a></p>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bazeldeps">
<span id="conan-tools-google-bazeldeps"></span><h1>BazelDeps<a class="headerlink" href="#bazeldeps" title="本標題的永久連結">¶</a></h1>
<div class="admonition important">
<p class="first admonition-title">重要</p>
<p class="last">This feature is still <strong>under development</strong>, while it is recommended and usable and we will try not to break them in future releases,
some breaking changes might still happen if necessary to prepare for the <em>Conan 2.0 release</em>.</p>
</div>
<p>Available since: <a class="reference external" href="https://github.com/conan-io/conan/releases/tag/1.37.0">1.37.0</a></p>
<div class="section" id="id2">
<h2>BazelDeps<a class="headerlink" href="#id2" title="本標題的永久連結">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">BazelDeps</span></code> is the dependencies generator for Bazel. Generates a <em>&lt;REPOSITORY&gt;/BUILD.bazel</em> file per dependency,
where the <em>&lt;REPOSITORY&gt;/</em> folder is the Conan recipe reference name by default, e.g., <em>mypkg/BUILD.bazel</em>. Apart from
that, it also generates a <em>dependencies.bzl</em> file which contains a Bazel function to load all your Conan dependencies.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BazelDeps</span></code> generator can be used by name in conanfiles:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">conanfile.py</span><a class="headerlink" href="#id5" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Pkg</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;BazelDeps&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">conanfile.txt</span><a class="headerlink" href="#id6" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[generators]
BazelDeps
</pre></div>
</div>
</div>
<p>And it can also be fully instantiated in the conanfile <code class="docutils literal notranslate"><span class="pre">generate()</span></code> method:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.google</span><span class="w"> </span><span class="kn">import</span> <span class="n">BazelDeps</span>

<span class="k">class</span><span class="w"> </span><span class="nc">App</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="s2">&quot;zlib/1.2.11&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bz</span> <span class="o">=</span> <span class="n">BazelDeps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">bz</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">BazelDeps</span></code> generator is used, every invocation of <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> will
generate several bazel files. For the <em>conanfile.py</em>
above, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.
.
├──<span class="w"> </span>BUILD.bazel
├──<span class="w"> </span>conanfile.py
├──<span class="w"> </span>dependencies.bzl
└──<span class="w"> </span>zlib
<span class="w">    </span>└──<span class="w"> </span>BUILD.bazel
</pre></div>
</div>
<p>Every <strong class="command">conan install</strong> generates these files:</p>
<ul class="simple">
<li><em>BUILD.bazel</em>: An empty file aimed to be alongside the <em>dependencies.bzl</em> one.
More information <a class="reference external" href="https://bazel.build/concepts/build-files">here</a>.</li>
<li><em>dependencies.bzl</em>: this file tells your Bazel <em>WORKSPACE</em> how to load the dependencies.</li>
<li><em>zlib/BUILD.bazel</em>: contains all the targets that you can load from any of your <em>BUILD</em> files. More information in
<a class="reference internal" href="#conan-tools-google-bazeldeps-targets"><span class="std std-ref">Repository and target names</span></a>.</li>
</ul>
<p>Let’s check the content of the files created:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">dependencies.bzl</span><a class="headerlink" href="#id7" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This Bazel module should be loaded by your WORKSPACE file.</span>
<span class="c1"># Add these lines to your WORKSPACE one (assuming that you&#39;re using the &quot;bazel_layout&quot;):</span>
<span class="c1"># load(&quot;@//conan:dependencies.bzl&quot;, &quot;load_conan_dependencies&quot;)</span>
<span class="c1"># load_conan_dependencies()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_conan_dependencies</span><span class="p">():</span>
    <span class="n">native</span><span class="o">.</span><span class="n">new_local_repository</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;zlib&quot;</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/conan/package/folder/&quot;</span><span class="p">,</span>
        <span class="n">build_file</span><span class="o">=</span><span class="s2">&quot;/your/current/working/directory/zlib/BUILD.bazel&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Given the example above, and imagining that your WORKSPACE is at the same directory, you would have to add these lines in there:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">WORKSPACE</span><a class="headerlink" href="#id8" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;@//:dependencies.bzl&quot;</span><span class="p">,</span> <span class="s2">&quot;load_conan_dependencies&quot;</span><span class="p">)</span>
<span class="n">load_conan_dependencies</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">zlib/BUILD.bazel</span><a class="headerlink" href="#id9" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;@rules_cc//cc:defs.bzl&quot;</span><span class="p">,</span> <span class="s2">&quot;cc_import&quot;</span><span class="p">,</span> <span class="s2">&quot;cc_library&quot;</span><span class="p">)</span>

<span class="c1"># Components precompiled libs</span>
<span class="c1"># Root package precompiled libs</span>
<span class="n">cc_import</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;z_precompiled&quot;</span><span class="p">,</span>
    <span class="n">static_library</span> <span class="o">=</span> <span class="s2">&quot;lib/libz.a&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Components libraries declaration</span>
<span class="c1"># Package library declaration</span>
<span class="n">cc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;zlib&quot;</span><span class="p">,</span>
    <span class="n">hdrs</span> <span class="o">=</span> <span class="n">glob</span><span class="p">([</span>
        <span class="s2">&quot;include/**&quot;</span><span class="p">,</span>
    <span class="p">]),</span>
    <span class="n">includes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;include&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">visibility</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;//visibility:public&quot;</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;:z_precompiled&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Filegroup library declaration</span>
<span class="n">filegroup</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;zlib_binaries&quot;</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">glob</span><span class="p">([</span>
        <span class="s2">&quot;bin/**&quot;</span><span class="p">,</span>
    <span class="p">]),</span>
    <span class="n">visibility</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;//visibility:public&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>As you can observe, the <em>zlib/BUILD.bazel</em> defines these global targets:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">zlib</span></code>: bazel library target. The label used to depend on it would be <code class="docutils literal notranslate"><span class="pre">&#64;zlib//:zlib</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">zlib_binaries</span></code>: bazel filegroup target. The label used to depend on it would be <code class="docutils literal notranslate"><span class="pre">&#64;zlib//:zlib_binaries</span></code>.</li>
</ul>
<p>Since Conan 1.62.0, you can put all the files generated by <code class="docutils literal notranslate"><span class="pre">BazelDeps</span></code> into another folder using the <code class="docutils literal notranslate"><span class="pre">bazel_layout</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">conanfile.py</span><a class="headerlink" href="#id10" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.google</span><span class="w"> </span><span class="kn">import</span> <span class="n">BazelDeps</span><span class="p">,</span> <span class="n">bazel_layout</span>

<span class="k">class</span><span class="w"> </span><span class="nc">App</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="s2">&quot;zlib/1.2.11&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># DEPRECATED: Default generators folder will be &quot;conan&quot; in Conan 2.x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;conan&quot;</span>
        <span class="n">bazel_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bz</span> <span class="o">=</span> <span class="n">BazelDeps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">bz</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Running again the <strong class="command">conan install</strong> command, we now get this structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.
.
├──<span class="w"> </span>conan
│<span class="w">   </span>├──<span class="w"> </span>BUILD.bazel
│<span class="w">   </span>├──<span class="w"> </span>dependencies.bzl
│<span class="w">   </span>└──<span class="w"> </span>zlib
│<span class="w">       </span>└──<span class="w"> </span>BUILD.bazel
└──<span class="w"> </span>conanfile.py
</pre></div>
</div>
<p>Now your Conan-bazel files were generated in the <em>conan/</em> folder, so your WORKSPACE will look like:</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">WORKSPACE</span><a class="headerlink" href="#id11" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;@//conan:dependencies.bzl&quot;</span><span class="p">,</span> <span class="s2">&quot;load_conan_dependencies&quot;</span><span class="p">)</span>
<span class="n">load_conan_dependencies</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="build-context-activated">
<h3>build_context_activated<a class="headerlink" href="#build-context-activated" title="本標題的永久連結">¶</a></h3>
<p>Available since: <a class="reference external" href="https://github.com/conan-io/conan/releases/tag/1.62.0">1.62.0</a></p>
<p>When you have a <strong>build-requirement</strong>, by default, the Bazel files are not generated.
But you can activate it using the <strong>build_context_activated</strong> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;my_tool/0.0.1&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># DEPRECATED: Default generators folder will be &quot;conan&quot; in Conan 2.x</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;conan&quot;</span>
    <span class="n">bazel_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">bz</span> <span class="o">=</span> <span class="n">BazelDeps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># generate the build-mytool/BUILD.bazel file for the tool require</span>
    <span class="n">bz</span><span class="o">.</span><span class="n">build_context_activated</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;my_tool&quot;</span><span class="p">]</span>
    <span class="n">bz</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</pre></div>
</div>
<p>Running the <strong class="command">conan install</strong> command, the structure created is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>-pr:b<span class="w"> </span>default
.
├──<span class="w"> </span>conan
│<span class="w">   </span>├──<span class="w"> </span>BUILD.bazel
│<span class="w">   </span>├──<span class="w"> </span>build-my_tool
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>BUILD.bazel
│<span class="w">   </span>└──<span class="w"> </span>dependencies.bzl
└──<span class="w"> </span>conanfile.py
</pre></div>
</div>
<p>Notice that <em>my_tool</em> Bazel folder is prefixed with <code class="docutils literal notranslate"><span class="pre">build-</span></code> which indicates that it’s being used in the build context.</p>
</div>
<div class="section" id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="本標題的永久連結">¶</a></h3>
<p>Available since: <a class="reference external" href="https://github.com/conan-io/conan/releases/tag/1.62.0">1.62.0</a></p>
<p>The following properties affect the <code class="docutils literal notranslate"><span class="pre">BazelDeps</span></code> generator:</p>
<ul class="simple">
<li><strong>bazel_target_name</strong> property will define the name of the target declared in the <code class="docutils literal notranslate"><span class="pre">&lt;REPOSITORY&gt;/BUILD.bazel</span></code>.
This property can be defined at both global and component <code class="docutils literal notranslate"><span class="pre">cpp_info</span></code> level.</li>
<li><strong>bazel_repository_name</strong> property will define the name of the folder where the dependency <em>BUILD.bazel</em> will be
allocated. This property can only be defined at global <code class="docutils literal notranslate"><span class="pre">cpp_info</span></code> level.</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;my_target&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_repository_name&quot;</span><span class="p">,</span> <span class="s2">&quot;my_repo&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;mycomponent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;component_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="repository-and-target-names">
<span id="conan-tools-google-bazeldeps-targets"></span><h3>Repository and target names<a class="headerlink" href="#repository-and-target-names" title="本標題的永久連結">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;REPOSITORY&gt;/BUILD.bazel</span></code> file contains all the targets declared by the dependency. Both the <code class="docutils literal notranslate"><span class="pre">&lt;REPOSITORY&gt;/</span></code> folder and the targets
declared in there will be named following these rules by default:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>For packages, it uses the package name as folder/target name, e.g., package <code class="docutils literal notranslate"><span class="pre">zlib/1.2.11</span></code> will have:</dt>
<dd><ul class="first last">
<li>Folder: <code class="docutils literal notranslate"><span class="pre">zlib/BUILD.bazel</span></code>.</li>
<li>Global target: <code class="docutils literal notranslate"><span class="pre">zlib</span></code>.</li>
<li>How it can be consumed: <code class="docutils literal notranslate"><span class="pre">&#64;zlib//:zlib</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>For components, the package name + hyphen + component name, e.g., package <code class="docutils literal notranslate"><span class="pre">openssl/3.1.4</span></code> will have:</dt>
<dd><ul class="first last">
<li>Folder: <code class="docutils literal notranslate"><span class="pre">openssl/BUILD.bazel</span></code>.</li>
<li>Global target: <code class="docutils literal notranslate"><span class="pre">openssl</span></code>.</li>
<li>Components targets: <code class="docutils literal notranslate"><span class="pre">openssl-ssl</span></code>, and <code class="docutils literal notranslate"><span class="pre">openssl-crypto</span></code>.</li>
<li><dl class="first docutils">
<dt>How it can be consumed:</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">&#64;openssl//:openssl</span></code> (global one which includes all the components)</li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;openssl//:openssl-ssl</span></code> (component one)</li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;openssl//:openssl-crypto</span></code> (component one)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>You can change that default behavior with the <code class="docutils literal notranslate"><span class="pre">bazel_target_name</span></code> and the <code class="docutils literal notranslate"><span class="pre">bazel_repository_name</span></code> properties.
For instance, if <code class="docutils literal notranslate"><span class="pre">openssl/3.1.4</span></code> recipe would have has these <code class="docutils literal notranslate"><span class="pre">bazel_target_name</span></code> and <code class="docutils literal notranslate"><span class="pre">bazel_repository_name</span></code>
properties already declared:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">conanfile.py</span><a class="headerlink" href="#id12" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OpenSSLConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;openssl&quot;</span>

    <span class="c1"># any code here</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;local_openssl&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_repository_name&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenSSL&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;crypto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;libcrypto&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;ssl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;bazel_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;libssl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Run <strong class="command">conan install openssl/3.1.4&#64; -g BazelDeps</strong> and check the <code class="docutils literal notranslate"><span class="pre">*.pc</span></code> files created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>.<span class="w"> </span>-pr:b<span class="w"> </span>default
.
├──<span class="w"> </span>conan
│<span class="w">   </span>├──<span class="w"> </span>BUILD.bazel
│<span class="w">   </span>├──<span class="w"> </span>OpenSSL
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>BUILD.bazel
│<span class="w">   </span>└──<span class="w"> </span>dependencies.bzl
└──<span class="w"> </span>conanfile.py
</pre></div>
</div>
<p>The labels to use in your personal <em>BUILD</em> file would be:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&#64;OpenSSL//:local_openssl</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;OpenSSL//:libssl</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;OpenSSL//:libcrypto</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;OpenSSL//:local_openssl_binaries</span></code></li>
</ul>
<p>An example of a <em>BUILD</em> file consuming one of these targets could be something like this:</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">BUILD</span><a class="headerlink" href="#id13" title="本原始碼的永久連結">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;@rules_cc//cc:defs.bzl&quot;</span><span class="p">,</span> <span class="s2">&quot;cc_binary&quot;</span><span class="p">)</span>

<span class="n">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;example.cpp&quot;</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;@OpenSSL//:local_openssl&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bazeltoolchain.html" class="btn btn-neutral float-right" title="BazelToolchain" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../google.html" class="btn btn-neutral" title="conan.tools.google" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2022, JFrog.
      最後更新於 10月 27, 2025。
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.62.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/language_data.js"></script>
      <script type="text/javascript" src="../../../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../../../../_static/js/modernizr.min.js"></script>
  <script src="../../../../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("1.62");
  </script>


 


</body>
</html>