<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Products pipeline: the build-order &mdash; conan 2.11.0 說明文件</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/ci_tutorial/products_pipeline/build_order.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=272a52d3"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=d9a6981e"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />
    <link rel="next" title="Products pipeline: multi-product multi-configuration builds" href="multi_product.html" />
    <link rel="prev" title="Products pipeline: single configuration" href="single_configuration.html" />


 



</script>
<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">簡介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">教學</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">CI 教學</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../project_setup.html">Project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages_pipeline.html">Packages pipeline</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../products_pipeline.html">Products pipeline</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="single_configuration.html">Products pipeline: single configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Products pipeline: the build-order</a></li>
<li class="toctree-l3"><a class="reference internal" href="multi_product.html">Products pipeline: multi-product multi-configuration builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="full_pipeline.html">Products pipeline: distributed full pipeline with lockfiles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/devops.html">開發運維指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">範例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../incubating.html">孵化中的功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">變更日誌</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorial.html">Continuous Integration (CI) tutorial</a></li>
          <li class="breadcrumb-item"><a href="../products_pipeline.html">Products pipeline</a></li>
      <li class="breadcrumb-item active">Products pipeline: the build-order</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/ci_tutorial/products_pipeline/build_order.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="products-pipeline-the-build-order">
<h1>Products pipeline: the build-order<a class="headerlink" href="#products-pipeline-the-build-order" title="Link to this heading">¶</a></h1>
<p>The previous section used <code class="docutils literal notranslate"><span class="pre">--build=missing</span></code> to build all the necessary packages in the same CI machine.
This is not always desired, or even possible, and in many situations it is preferable to do a distributed build, to achieve faster builds and better usage the CI resources. The most natural distribution of the build load is to build different packages in different machines. Let’s see how this is possible with the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">build-order</span></code> command.</p>
<p>Let’s start as usual making sure we have a clean environment with the right repositories defined:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># First clean the local &quot;build&quot; folder</span>
$<span class="w"> </span><span class="nb">pwd</span><span class="w">  </span><span class="c1"># should be &lt;path&gt;/examples2/ci/game</span>
$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build<span class="w">  </span><span class="c1"># clean the temporary build folder</span>
$<span class="w"> </span>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build<span class="w"> </span><span class="c1"># To put temporary files</span>

$<span class="w"> </span>conan<span class="w"> </span>remove<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span>-c<span class="w">  </span><span class="c1"># Make sure no packages from last run</span>
<span class="c1"># NOTE: The products repo is first, it will have higher priority.</span>
$<span class="w"> </span>conan<span class="w"> </span>remote<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>products
</pre></div>
</div>
<p>We will obviate by now the <code class="docutils literal notranslate"><span class="pre">mapviewer/1.0</span></code> product and focus this section in the <code class="docutils literal notranslate"><span class="pre">game/1.0</span></code> product.
The first step is to compute the 「build-order」, that is, the list of packages that need to be built, and in what order.
This is done with the following <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">build-order</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>build-order<span class="w"> </span>--requires<span class="o">=</span>game/1.0<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>--order-by<span class="o">=</span>recipe<span class="w"> </span>--reduce<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>game_build_order.json
</pre></div>
</div>
<p>Note a few important points:</p>
<ul class="simple">
<li><p>It is necessary to use the <code class="docutils literal notranslate"><span class="pre">--build=missing</span></code>, in exactly the same way than in the previous section. Failing to provide the intended <code class="docutils literal notranslate"><span class="pre">--build</span></code> policy and argument will result in incomplete or erroneous build-orders.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--reduce</span></code> argument eliminates all elements in the resulting order that don’t have the <code class="docutils literal notranslate"><span class="pre">binary:</span> <span class="pre">Build</span></code> policy. This means that the resulting 「build-order」 cannot be merged with other build order files for aggregating them into a single one, which is important when there are multiple configurations and products.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--order-by</span></code> argument allows to define different orders, by 「recipe」 or by 「configuration」. In this case, we are using <code class="docutils literal notranslate"><span class="pre">--order-by=recipe</span></code> which is intended to parallelize builds per recipe, that means, that all possible different binaries for a given package like <code class="docutils literal notranslate"><span class="pre">engine/1.0</span></code> should be built first before any consumer of <code class="docutils literal notranslate"><span class="pre">engine/1.0</span></code> can be built.</p></li>
</ul>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">game_build_order.json</span></code> looks like:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">game_build_order.json</span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;order_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;recipe&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reduced&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;engine/1.0#fba6659c9dd04a4bbdc7a375f22143cb&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">&quot;packages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                      </span><span class="p">[</span>
<span class="w">                          </span><span class="p">{</span>
<span class="w">                              </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;de738ff5d09f0359b81da17c58256c619814a765&quot;</span><span class="p">,</span>
<span class="w">                              </span><span class="nt">&quot;binary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Build&quot;</span><span class="p">,</span>
<span class="w">                              </span><span class="nt">&quot;build_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--requires=engine/1.0 --build=engine/1.0&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="p">}</span>
<span class="w">                      </span><span class="p">]</span>
<span class="w">                  </span><span class="p">]</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;game/1.0#1715574045610faa2705017c71d0000e&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">&quot;depends&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                      </span><span class="s2">&quot;engine/1.0#fba6659c9dd04a4bbdc7a375f22143cb&quot;</span>
<span class="w">                  </span><span class="p">],</span>
<span class="w">                  </span><span class="nt">&quot;packages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                      </span><span class="p">[</span>
<span class="w">                          </span><span class="p">{</span>
<span class="w">                              </span><span class="nt">&quot;package_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bac7cd2fe1592075ddc715563984bbe000059d4c&quot;</span><span class="p">,</span>
<span class="w">                              </span><span class="nt">&quot;binary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Build&quot;</span><span class="p">,</span>
<span class="w">                              </span><span class="nt">&quot;build_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--requires=game/1.0 --build=game/1.0&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="p">}</span>
<span class="w">                      </span><span class="p">]</span>
<span class="w">                  </span><span class="p">]</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>For convenience, in the same way that <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">info</span> <span class="pre">...</span> <span class="pre">--format=html</span> <span class="pre">&gt;</span> <span class="pre">graph.html</span></code> can generate a file with an HTML interactive dependency graph, the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">build-order</span> <span class="pre">...</span> <span class="pre">--format=html</span> <span class="pre">&gt;</span> <span class="pre">build_order.html</span></code> can generate an HTML visual representation of the above json file:</p>
<a class="reference internal image-reference" href="../../_images/build_order_simple.png"><img alt="../../_images/build_order_simple.png" class="align-center" src="../../_images/build_order_simple.png" style="width: 500px;" /></a>
<p>The resulting json contains an <code class="docutils literal notranslate"><span class="pre">order</span></code> element which is a list of lists. This arrangement is important, every element in the top list is a set of packages that can be built in parallel because they do not have any relationship among them. You can view this list as a list of 「levels」, in level 0, there are packages that have no dependencies to any other package being built, in level 1 there are packages that contain dependencies only to elements in level 0 and so on.</p>
<p>Then, the order of the elements in the outermost list is important and must be respected. Until the build of all the packages in one list item has finished, it is not possible to start the build of the next 「level」.</p>
<p>Using the information in the <code class="docutils literal notranslate"><span class="pre">graph_build_order.json</span></code> file, it is possible to execute the build of the necessary packages, in the same way that the previous section’s <code class="docutils literal notranslate"><span class="pre">--build=missing</span></code> did, but not directly managed by us.</p>
<p>Taking the arguments from the json, the commands to execute would be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>engine/1.0<span class="w"> </span>--build<span class="o">=</span>engine/1.0
$<span class="w"> </span>conan<span class="w"> </span>install<span class="w"> </span>--requires<span class="o">=</span>game/1.0<span class="w"> </span>--build<span class="o">=</span>game/1.0
</pre></div>
</div>
<p>We are executing these commands manually, but in practice, it would be a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop in CI executing over the json output. We will see some Python code later for this. At this point we wanted to focus on the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span> <span class="pre">build-order</span></code> command, but we haven’t really explained how the build is distributed.</p>
<p>Also note that inside every element there is an inner list of lists, the <code class="docutils literal notranslate"><span class="pre">&quot;packages&quot;</span></code> section, for all the binaries that must be built for a specific recipe for different configurations.</p>
<p>Let’s move now to see how a multi-product, multi-configuration build order can be computed.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="single_configuration.html" class="btn btn-neutral float-left" title="Products pipeline: single configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multi_product.html" class="btn btn-neutral float-right" title="Products pipeline: multi-product multi-configuration builds" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最後更新於 10月 28, 2025。
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>