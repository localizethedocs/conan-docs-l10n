<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Define components for Conan packages that provide multiple libraries &mdash; conan 2.11.0 說明文件</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/examples/conanfile/package_info/components.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=272a52d3"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/translations.js?v=d9a6981e"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜尋" href="../../../search.html" />
    <link rel="next" title="ConanFile layout() 範例" href="../layout.html" />
    <link rel="prev" title="Propagating environment or configuration information to consumers" href="package_info_conf_and_env.html" />


 



</script>
<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">簡介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ci_tutorial/tutorial.html">CI 教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devops/devops.html">開發運維指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../examples.html">範例</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../conanfile.html">ConanFile 方法範例</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../package_info.html">ConanFile package_info() 範例</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="package_info_conf_and_env.html">Propagating environment or configuration information to consumers</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Define components for Conan packages that provide multiple libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../layout.html">ConanFile layout() 範例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extensions.html">Conan extensions examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools.html">Conan recipe tools examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cross_build.html">Cross-building examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config_files.html">組態檔範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../graph.html">Graph examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_flow.html">Developer tools and flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../commands.html">Conan 命令範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../runners.html">Conan runners examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../incubating.html">孵化中的功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">變更日誌</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../examples.html">範例</a></li>
          <li class="breadcrumb-item"><a href="../../conanfile.html">ConanFile 方法範例</a></li>
          <li class="breadcrumb-item"><a href="../package_info.html">ConanFile package_info() 範例</a></li>
      <li class="breadcrumb-item active">Define components for Conan packages that provide multiple libraries</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/conanfile/package_info/components.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="define-components-for-conan-packages-that-provide-multiple-libraries">
<span id="examples-conanfile-package-info-components"></span><h1>Define components for Conan packages that provide multiple libraries<a class="headerlink" href="#define-components-for-conan-packages-that-provide-multiple-libraries" title="Link to this heading">¶</a></h1>
<p>At the <a class="reference internal" href="../../../tutorial/creating_packages/define_package_information.html#tutorial-creating-define-package-info"><span class="std std-ref">section of the tutorial about the package_info() method</span></a>, we learned how to define information in a package for
consumers, such as library names or include and library folders. In the tutorial, we
created a package with only one library that consumers linked to. However, in some cases,
libraries provide their functionalities separated into different <em>components</em>. These
components can be consumed independently, and in some cases, they may require other
components from the same library or others. For example, consider a library like OpenSSL
that provides <em>libcrypto</em> and <em>libssl</em>, where <em>libssl</em> depends on <em>libcrypto</em>.</p>
<p>Conan provides a way to abstract this information using the <cite>components</cite> attribute of the
<cite>CppInfo</cite> object to define the information for each separate component of a Conan package.
Consumers can also select specific components to link against but not the rest of the
package.</p>
<p>Let’s take a game-engine library as an example, which provides several components such as
<em>algorithms</em>, <em>ai</em>, <em>rendering</em>, and <em>network</em>. Both <em>ai</em> and <em>rendering</em> depend on the <em>algorithms</em>
component.</p>
<figure class="align-default" id="id1">
<div class="graphviz"><object data="../../../_images/graphviz-b99e8bbb2dffefe30c303cef653992b1f008c154.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph components {
    node [fillcolor=&quot;lightskyblue&quot;, style=filled, shape=box]
    algorithms -&gt; ai;
    algorithms -&gt; rendering;
    ai;
    algorithms;
    network;
}</p></object></div>
<figcaption>
<p><span class="caption-text">components of the game-engine package</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2 repository</a> in GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/examples/conanfile/package_info/components
</pre></div>
</div>
<p>You can check the contents of the project:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
├── CMakeLists.txt
├── conanfile.py
├── include
│   ├── ai.h
│   ├── algorithms.h
│   ├── network.h
│   └── rendering.h
├── src
│   ├── ai.cpp
│   ├── algorithms.cpp
│   ├── network.cpp
│   └── rendering.cpp
└── test_package
    ├── CMakeLists.txt
    ├── CMakeUserPresets.json
    ├── conanfile.py
    └── src
        └── example.cpp
</pre></div>
</div>
<p>As you can see, there are sources for each of the components and a CMakeLists.txt file to
build them. We also have a <cite>test_package</cite> that we are going to use to test the consumption
of the separate components.</p>
<p>First, let’s have a look at package_info() method in the <em>conanfile.py</em> and how we declared
the information for each component that we want to provide to the consumers of the
game-engine package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;algorithms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;algorithms&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;algorithms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;algorithms&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;ai&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ai&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;ai&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;algorithms&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;ai&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;ai&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;rendering&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rendering&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;rendering&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;algorithms&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;rendering&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;rendering&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are a couple of relevant things:</p>
<ul class="simple">
<li><p>We declare the libraries generated by each of the components by setting information in
the <code class="docutils literal notranslate"><span class="pre">cpp_info.components</span></code> attribute. You can set the same information for each of the
components as you would for the <code class="docutils literal notranslate"><span class="pre">self.cpp_info</span></code> object. The <code class="docutils literal notranslate"><span class="pre">cpp_info</span></code> for
components has some defaults defined, just like it does for
<a class="reference internal" href="../../../tutorial/creating_packages/define_package_information.html#tutorial-creating-define-package-info"><span class="std std-ref">self.cpp_info</span></a>. For example, the
<code class="docutils literal notranslate"><span class="pre">cpp_info.components</span></code> object provides the <code class="docutils literal notranslate"><span class="pre">.includedirs</span></code> and <code class="docutils literal notranslate"><span class="pre">.libdirs</span></code> properties
to define those locations, but Conan sets their value as <code class="docutils literal notranslate"><span class="pre">[&quot;lib&quot;]</span></code> and <code class="docutils literal notranslate"><span class="pre">[&quot;include&quot;]</span></code> by default,
so it’s not necessary to add them in this case.</p></li>
<li><p>We are also declaring the components』 dependencies using the <code class="docutils literal notranslate"><span class="pre">.requires</span></code> attribute.
With this attribute, you can declare requirements at the component level, not only for
components in the same recipe but also for components from other packages that are
declared as requires of the Conan package.</p></li>
<li><p>We are changing the default target names for the components using the <a class="reference internal" href="../../../tutorial/creating_packages/define_package_information.html#tutorial-creating-define-package-info-properties"><span class="std std-ref">properties
model</span></a>. By default, Conan sets a
target name for components like <code class="docutils literal notranslate"><span class="pre">&lt;package_name::component_name&gt;</span></code>, but for this
tutorial we will set the component target names just with the component names omitting
the <code class="docutils literal notranslate"><span class="pre">::</span></code>.</p></li>
</ul>
<p>You can have a look at the consumer part by checking the <em>test_package</em> folder. First the
<em>conanfile.py</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="n">CMakeDeps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">deps</span><span class="o">.</span><span class="n">check_components_exist</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">deps</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</pre></div>
</div>
<p>You can see that we are setting the <a class="reference internal" href="../../../reference/tools/cmake/cmakedeps.html#conan-tools-cmakedeps-check-components-exist"><span class="std std-ref">check_components_exist</span></a> property for CMakeDeps. This is not
needed, just to show how you can do if you want your consumers to fail if the component
does not exist. So, the CMakeLists.txt could look like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cmake_minimum_required(VERSION 3.15)
project(PackageTest CXX)

find_package(game-engine REQUIRED COMPONENTS algorithms network ai rendering)

add_executable(example src/example.cpp)

target_link_libraries(example algorithms
                              network
                              ai
                              rendering)
</pre></div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">find_package()</span></code> call would fail if any of the components targets do not exist.</p>
<p>Let’s run the example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ conan create .
...
game-engine/1.0: RUN: cmake --build &quot;/Users/barbarian/.conan2/p/t/game-d6e361d329116/b/build/Release&quot; -- -j16
[ 12%] Building CXX object CMakeFiles/algorithms.dir/src/algorithms.cpp.o
[ 25%] Building CXX object CMakeFiles/network.dir/src/network.cpp.o
[ 37%] Linking CXX static library libnetwork.a
[ 50%] Linking CXX static library libalgorithms.a
[ 50%] Built target network
[ 50%] Built target algorithms
[ 62%] Building CXX object CMakeFiles/ai.dir/src/ai.cpp.o
[ 75%] Building CXX object CMakeFiles/rendering.dir/src/rendering.cpp.o
[ 87%] Linking CXX static library libai.a
[100%] Linking CXX static library librendering.a
[100%] Built target ai
[100%] Built target rendering
...

======== Launching test_package ========

...
-- Conan: Component target declared &#39;algorithms&#39;
-- Conan: Component target declared &#39;network&#39;
-- Conan: Component target declared &#39;ai&#39;
-- Conan: Component target declared &#39;rendering&#39;
...
[ 50%] Building CXX object CMakeFiles/example.dir/src/example.cpp.o
[100%] Linking CXX executable example
[100%] Built target example


======== Testing the package: Executing test ========
game-engine/1.0 (test package): Running test()
game-engine/1.0 (test package): RUN: ./example
I am the algorithms component!
I am the network component!
I am the ai component!
└───&gt; I am the algorithms component!
I am the rendering component!
└───&gt; I am the algorithms component!
</pre></div>
</div>
<p>You could check that requiring a component that does not exist will raise an error. Add
the <em>nonexistent</em> component to the find_package() call:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cmake_minimum_required(VERSION 3.15)
project(PackageTest CXX)

find_package(game-engine REQUIRED COMPONENTS nonexistent algorithms network ai rendering)

add_executable(example src/example.cpp)

target_link_libraries(example algorithms
                              network
                              ai
                              rendering)
</pre></div>
</div>
<p>And test the package again:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ conan test test_package game-engine/1.0

...

Conan: Component &#39;nonexistent&#39; NOT found in package &#39;game-engine&#39;
Call Stack (most recent call first):
CMakeLists.txt:4 (find_package)

-- Configuring incomplete, errors occurred!

...

ERROR: game-engine/1.0 (test package): Error in build() method, line 22
        cmake.configure()
        ConanException: Error 1 while executing
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">也參考</p>
<p>If you want to use recipes defining components in <code class="docutils literal notranslate"><span class="pre">editable</span></code> mode, check the example in
<a class="reference internal" href="../layout/editable_components.html#examples-conanfile-layout-components-editables"><span class="std std-ref">Using components and editable packages</span></a>.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="package_info_conf_and_env.html" class="btn btn-neutral float-left" title="Propagating environment or configuration information to consumers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../layout.html" class="btn btn-neutral float-right" title="ConanFile layout() 範例" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最後更新於 10月 28, 2025。
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>