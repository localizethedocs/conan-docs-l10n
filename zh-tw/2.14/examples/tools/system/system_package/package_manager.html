<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wrapping system requirements in a Conan package &mdash; conan 2.14.0 說明文件</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/examples/tools/system/system_package/package_manager.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=a8f19ee2"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/translations.js?v=d9a6981e"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜尋" href="../../../../search.html" />
    <link rel="next" title="Consuming system requirements only when building a package" href="consuming_system_packages.html" />
    <link rel="prev" title="System Packages" href="../system.html" />


 



</script>
<script type="text/javascript" src="../../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html">
            
              <img src="../../../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.14
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">介紹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ci_tutorial/tutorial.html">CI 教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devops/devops.html">開發運維指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../examples.html">範例</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../conanfile.html">ConanFile 方法範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extensions.html">Conan 擴充功能範例</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../tools.html">Conan recipe tools examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../cmake/cmake.html">CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../files/files.html">File interaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../meson/meson.html">Meson</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../google/bazel.html">Bazel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autotools/autotools.html">Autotools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm/git/capture_scm/git_capture_scm.html">Capturing Git scm information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../microsoft/msbuild.html">MSBuild</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../system.html">System Packages</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Wrapping system requirements in a Conan package</a></li>
<li class="toctree-l4"><a class="reference internal" href="consuming_system_packages.html">Consuming system requirements only when building a package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cross_build.html">交叉建置範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_files.html">組態檔範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../graph.html">Graph examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_flow.html">開發者工具與流程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../commands.html">Conan 命令範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../runners.html">Conan 執行器範例</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../incubating.html">孵化中的功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">變更日誌</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../examples.html">範例</a></li>
          <li class="breadcrumb-item"><a href="../../../tools.html">Conan recipe tools examples</a></li>
          <li class="breadcrumb-item"><a href="../system.html">System Packages</a></li>
      <li class="breadcrumb-item active">Wrapping system requirements in a Conan package</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/tools/system/system_package/package_manager.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="wrapping-system-requirements-in-a-conan-package">
<span id="examples-tools-system-package-manager"></span><h1>Wrapping system requirements in a Conan package<a class="headerlink" href="#wrapping-system-requirements-in-a-conan-package" title="Link to this heading">¶</a></h1>
<p>Conan can manage system packages, allowing you to install platform-specific dependencies easily.
This is useful when you need to install platform-specific system packages.
For example, you may need to install a package that provides a specific driver or graphics library that only works on a specific platform.</p>
<p>Conan provides a way to install system packages using the <a class="reference internal" href="../../../../reference/tools/system/package_manager.html#conan-tools-system-package-manager"><span class="std std-ref">system package manager</span></a> tool.</p>
<p>In this example, we are going to explore the steps needed to create a wrapper package around a system library and what is needed to consume it in a Conan package.
Note that the package will not contain the binary artifacts, it will just manage to check/install them calling <code class="docutils literal notranslate"><span class="pre">system_requirements()</span></code> and the respective system package managers (e.g Apt, Yum).
In this example, we are going to create a Conan package to wrap the system <a class="reference external" href="https://invisible-island.net/ncurses/">ncurses</a>
requirement and then show how to use this requirement in an application.</p>
<p>Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2 repository</a> on GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/examples/tools/system/package_manager/
</pre></div>
</div>
<p>You will find the following tree structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
├── conanfile.py
└── consumer
    ├── CMakeLists.txt
    ├── conanfile.py
    └── ncurses_version.c
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> file is the recipe that wraps the ncurses system library.
Finally, the <strong>consumer</strong> directory contains a simple C application that uses the ncurses library, we will visit it later.</p>
<p>When wrapping a pre-built system library, we do not need to build the project from source, only install the
system library and package its information.
In this case, we are going to check the <strong>conanfile.py</strong> file that packages the ncurses library first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.system</span><span class="w"> </span><span class="kn">import</span> <span class="n">package_manager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.gnu</span><span class="w"> </span><span class="kn">import</span> <span class="n">PkgConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanInvalidConfiguration</span>

<span class="n">required_conan_version</span> <span class="o">=</span> <span class="s2">&quot;&gt;=2.0&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SysNcursesConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ncurses&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;system&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;A textual user interfaces that work across a wide variety of terminals&quot;</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;curses&quot;</span><span class="p">,</span> <span class="s2">&quot;terminal&quot;</span><span class="p">,</span> <span class="s2">&quot;toolkit&quot;</span><span class="p">)</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://invisible-mirror.net/archives/ncurses/&quot;</span>
    <span class="n">license</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
    <span class="n">package_type</span> <span class="o">=</span> <span class="s2">&quot;shared-library&quot;</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">package_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">supported_os</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Linux&quot;</span><span class="p">,</span> <span class="s2">&quot;Macos&quot;</span><span class="p">,</span> <span class="s2">&quot;FreeBSD&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_os</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConanInvalidConfiguration</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="si">}</span><span class="s2"> wraps a system package only supported by </span><span class="si">{</span><span class="n">supported_os</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">system_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dnf</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">Dnf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dnf</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;ncurses-devel&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">yum</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">Yum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">yum</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;ncurses-devel&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">apt</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">Apt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">apt</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;libncurses-dev&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pacman</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">PacMan</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">pacman</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;ncurses&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">zypper</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">Zypper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">zypper</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;ncurses&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">brew</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">Brew</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">brew</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;ncurses&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pkg</span> <span class="o">=</span> <span class="n">package_manager</span><span class="o">.</span><span class="n">Pkg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">pkg</span><span class="o">.</span><span class="n">install</span><span class="p">([</span><span class="s2">&quot;ncurses&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">bindirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">includedirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">libdirs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Curses&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Curses::Curses&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_additional_variables_prefixes&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;CURSES&quot;</span><span class="p">,])</span>

        <span class="n">pkg_config</span> <span class="o">=</span> <span class="n">PkgConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ncurses&#39;</span><span class="p">)</span>
        <span class="n">pkg_config</span><span class="o">.</span><span class="n">fill_cpp_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="p">,</span> <span class="n">is_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In this <strong>conanfile.py</strong> file, we are using the <a class="reference internal" href="../../../../reference/tools/system/package_manager.html#conan-tools-system-package-manager"><span class="std std-ref">system package manager</span></a> tool
to install the ncurses library based on different package managers, under the
<a class="reference internal" href="../../../../reference/conanfile/methods/system_requirements.html#reference-conanfile-methods-system-requirements"><span class="std std-ref">system_requirements</span></a> method. It’s important to note that the
<code class="docutils literal notranslate"><span class="pre">system_requirements</span></code> method is called always, when building, or even if the package is already installed.
This is useful to ensure that the package is installed in the system.</p>
<p>Each package manager may vary the package name used to install the ncurses library, so we need to check the package manager
documentation to find the correct package name first.</p>
<p>Another important detail is the <strong>package_info</strong> method. In this method, we are using the
<a class="reference internal" href="../../../../reference/tools/gnu/pkgconfig.html#conan-tools-gnu-pkgconfig"><span class="std std-ref">PkgConfig</span></a> tool to fill the <strong>cpp_info</strong> data, based on the file <code class="docutils literal notranslate"><span class="pre">ncurses.pc</span></code>
installed by the system package manager.</p>
<p>Now, let’s install the ncurses library using the <strong>conanfile.py</strong> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>-c<span class="w"> </span>tools.system.package_manager:mode<span class="o">=</span>install<span class="w"> </span>-c<span class="w"> </span>tools.system.package_manager:sudo<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>Note that we are using the <a class="reference internal" href="../../../../reference/tools/system/package_manager.html#conan-tools-system-package-manager-config"><span class="std std-ref">Conan configuration</span></a>
<code class="docutils literal notranslate"><span class="pre">tools.system.package_manager:mode</span></code> as <strong>install</strong>, otherwise, Conan will not install the system package, but check
if it is installed only. The same for <code class="docutils literal notranslate"><span class="pre">tools.system.package_manager:sudo</span></code> as <strong>True</strong> to run the package manager with root privileges.
As a result of this command, you should be able to see the <strong>ncurses</strong> library installed in your system, in case not been installed yet.</p>
<p>Now, let’s check the <strong>consumer</strong> directory. This directory contains a simple C application that uses the ncurses library.</p>
<p>The <strong>conanfile.py</strong> file in the <strong>consumer</strong> directory is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.build</span><span class="w"> </span><span class="kn">import</span> <span class="n">can_run</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.cmake</span><span class="w"> </span><span class="kn">import</span> <span class="n">cmake_layout</span><span class="p">,</span> <span class="n">CMake</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AppNCursesVersionConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeDeps&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeToolchain&quot;</span>
    <span class="n">package_type</span> <span class="o">=</span> <span class="s2">&quot;application&quot;</span>
    <span class="n">exports_sources</span> <span class="o">=</span> <span class="s2">&quot;CMakeLists.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;ncurses_version.c&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Linux&quot;</span><span class="p">,</span> <span class="s2">&quot;Macos&quot;</span><span class="p">,</span> <span class="s2">&quot;FreeBSD&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;ncurses/system&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmake_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmake</span> <span class="o">=</span> <span class="n">CMake</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="n">app_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_folder</span><span class="p">,</span> <span class="s2">&quot;ncurses_version&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The example application has been successfully built.</span><span class="se">\n</span><span class="s2">Please run the executable using: &#39;</span><span class="si">{</span><span class="n">app_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The recipe is simple. It requires the <strong>ncurses</strong> package we just created and uses the <strong>CMake</strong> tool to build the application.
Once the application is built, it shows the <strong>ncurses_version</strong> application path, so you can run it manually as you wish and check its output.</p>
<p>The <strong>ncurses_version.c</strong> file is a simple C application that uses the ncurses library to print the ncurses version,
but using white background and blue text:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ncurses.h&gt;</span>


<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_y</span><span class="p">,</span><span class="w"> </span><span class="n">max_x</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">[</span><span class="mi">256</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

<span class="w">    </span><span class="n">initscr</span><span class="p">();</span>

<span class="w">    </span><span class="n">start_color</span><span class="p">();</span>
<span class="w">    </span><span class="n">init_pair</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">COLOR_BLUE</span><span class="p">,</span><span class="w"> </span><span class="n">COLOR_WHITE</span><span class="p">);</span>
<span class="w">    </span><span class="n">getmaxyx</span><span class="p">(</span><span class="n">stdscr</span><span class="p">,</span><span class="w"> </span><span class="n">max_y</span><span class="p">,</span><span class="w"> </span><span class="n">max_x</span><span class="p">);</span>

<span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">message</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Conan 2.x Examples - Installed ncurses version: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">curses_version</span><span class="p">());</span>
<span class="w">    </span><span class="n">attron</span><span class="p">(</span><span class="n">COLOR_PAIR</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">    </span><span class="n">mvprintw</span><span class="p">(</span><span class="n">max_y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">max_x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="n">attroff</span><span class="p">(</span><span class="n">COLOR_PAIR</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="w">    </span><span class="n">refresh</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <strong>CMakeLists.txt</strong> file is a simple CMake file that builds the <strong>ncurses_version</strong> application:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.15</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">ncurses_version</span><span class="w"> </span><span class="s">C</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">Curses</span><span class="w"> </span><span class="s">CONFIG</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">ncurses_version.c</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">Curses::Curses</span><span class="p">)</span>
</pre></div>
</div>
<p>The CMake target <strong>Curses::Curses</strong> is provided by the <strong>ncurses</strong> package we just created. It follows the official CMake module for <a class="reference external" href="https://cmake.org/cmake/help/latest/module/FindCurses.html">FindCurses</a>.
The information about libraries and include directories is now available in the <strong>cpp_info</strong> object, as we filled it using the <strong>PkgConfig</strong> tool.</p>
<p>Now, let’s build the application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>consumer/
$<span class="w"> </span>conan<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>--name<span class="o">=</span>ncurses-version<span class="w"> </span>--version<span class="o">=</span><span class="m">0</span>.1.0
<span class="w">  </span>...
<span class="w">  </span>conanfile.py<span class="w"> </span><span class="o">(</span>ncurses-version/0.1.0<span class="o">)</span>:<span class="w"> </span>The<span class="w"> </span>example<span class="w"> </span>application<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>successfully<span class="w"> </span>built.
<span class="w">  </span>Please<span class="w"> </span>run<span class="w"> </span>the<span class="w"> </span>executable<span class="w"> </span>using:<span class="w"> </span><span class="s1">&#39;/tmp/consumer/build/Release/ncurses_version&#39;</span>
</pre></div>
</div>
<p>After building the application, it will show the executable path. You can run it to check the output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>/tmp/consumer/build/Release/ncurses_version

Conan<span class="w"> </span><span class="m">2</span>.x<span class="w"> </span>Examples<span class="w"> </span>-<span class="w"> </span>Installed<span class="w"> </span>ncurses<span class="w"> </span>version:<span class="w"> </span>ncurses<span class="w"> </span><span class="m">6</span>.0.20160213
</pre></div>
</div>
<p>Don’t worry if the displayed version is different from the one shown here or the executable path different.
It depends on the version installed in your system and where you built the application.</p>
<p>That’s it! You have successfully packaged a system library and consumed it in a Conan package.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../system.html" class="btn btn-neutral float-left" title="System Packages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="consuming_system_packages.html" class="btn btn-neutral float-right" title="Consuming system requirements only when building a package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最後更新於 2月 17, 2026。
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>