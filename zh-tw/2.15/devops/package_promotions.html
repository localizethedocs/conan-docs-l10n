<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Package promotions &mdash; conan 2.15.1 說明文件</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/devops/package_promotions.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=25753662"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=d9a6981e"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜尋" href="../search.html" />
    <link rel="next" title="Checking package vulnerabilities" href="audit.html" />
    <link rel="prev" title="Vendoring dependencies in Conan packages" href="vendoring.html" />


 



</script>
<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">簡介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci_tutorial/tutorial.html">CI 教學</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="devops.html">開發運維指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="using_conancenter.html">Using ConanCenter packages in production environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="devops_local_recipes_index.html">Local Recipes Index Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_sources/sources_backup.html">Backing up third-party sources with Conan</a></li>
<li class="toctree-l2"><a class="reference internal" href="metadata.html">Managing package metadata files</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning/versioning.html">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="save_restore.html">Save and restore packages from/to the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="vendoring.html">Vendoring dependencies in Conan packages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Package promotions</a></li>
<li class="toctree-l2"><a class="reference internal" href="audit.html">Checking package vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">範例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../incubating.html">孵化中的功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">變更日誌</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="devops.html">開發運維指南</a></li>
      <li class="breadcrumb-item active">Package promotions</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/devops/package_promotions.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="package-promotions">
<span id="devops-package-promotions"></span><h1>Package promotions<a class="headerlink" href="#package-promotions" title="Link to this heading">¶</a></h1>
<p>Package promotions are the recommended devops practice to handle quality, maturity or stages of packages
in different technologies, and of course, also for Conan packages.</p>
<p>The principle of package promotions is that there are multiple server package repositories defined and
packages are uploaded and copied among repositories depending on the stage. For
example we could have two different server package repositories called 「testing」 and 「release」:</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../_images/graphviz-82d8ac4cd195f0053d318bfe3495a77d837ae9e7.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph repositories {
    node [fillcolor=&quot;lightblue&quot;, style=filled, shape=box]
    rankdir=&quot;LR&quot;;
    subgraph cluster_0 {
        style=filled;
                color=lightgrey;
        rankdir=&quot;LR&quot;;
        label = &quot;Packages server&quot;;
        &quot;testing\n repository&quot; -&gt; &quot;release\n repository&quot; [ label=&quot;promotion&quot; ];
    }
}</p></object></div>
</div>
<div class="admonition note">
<p class="admonition-title">備註</p>
<p><strong>最佳實踐</strong></p>
<ul class="simple">
<li><p>Using different <code class="docutils literal notranslate"><span class="pre">user/channel</span></code> to try to denote maturity is strongly discouraged. It was described in the early
Conan 1 days years ago, before the possibility of having multiple repositories, but it shouldn’t be used anymore.</p></li>
<li><p>Packages should be completely immutable accross pipelines and stages, a package cannot rename or change its <code class="docutils literal notranslate"><span class="pre">user/channel</span></code>,
and re-building it from source to have a new <code class="docutils literal notranslate"><span class="pre">user/channel</span></code> is also a strongly discourage devops practice.</p></li>
</ul>
</div>
<p>Between those repositories there will be some quality gates. In our case, some packages will be
put in the 「testing」 repository, for the QA team to test them, for example <code class="docutils literal notranslate"><span class="pre">zlib/1.3.1</span></code> and <code class="docutils literal notranslate"><span class="pre">openssl/3.2.2</span></code>:</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../_images/graphviz-2a2702442fcdaa6881b5b4b2c43cc18fbdec1e80.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph repositories {
    node [fillcolor=&quot;lightskyblue&quot;, style=filled, shape=box]
    rankdir=&quot;LR&quot;;
    subgraph cluster_0 {
        label=&quot;Packages server&quot;;
        style=filled;
        color=lightgrey;
        subgraph cluster_1 {
            label = &quot;testing\n repository&quot;
            shape = &quot;box&quot;;
            style=filled;
            color=lightblue;
            &quot;zlib/1.3.1&quot;;
            &quot;openssl/3.2.2&quot;;
        }

        subgraph cluster_2 {
            label = &quot;release\n repository&quot;
            shape = &quot;box&quot;;
            style=filled;
            color=lightblue;
            &quot;release&quot; [style=invis];
        }
        {
            edge[style=invis];
            &quot;zlib/1.3.1&quot; -&gt; &quot;release&quot; ;
            rankdir=&quot;BT&quot;;
        }
    }
}</p></object></div>
</div>
<p>When the QA team tests and approves these packages, they can be promoted to the 「release」 repository.
Basically, a promotion is a copy of the packages, including all the artifacts and metadata from the
「testing」 to the 「release」 repository.</p>
<p>There are different ways to implement and execute a package promotion. Artifactory has some APIs that can be
used to move individual files or folders. The <a class="reference external" href="https://github.com/conan-io/conan-extensions">Conan extensions repository</a>
contains the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">art:promote</span></code> command that can be used to promote Conan 「package lists」 from one
server repository to another repository.</p>
<p>If we have a package list <code class="docutils literal notranslate"><span class="pre">pkglist.json</span></code> that contains the above <code class="docutils literal notranslate"><span class="pre">zlib/1.3.1</span></code> and <code class="docutils literal notranslate"><span class="pre">openssl/3.2.2</span></code> packages, then
the command would look like:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Promoting from testing-&gt;release</span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>art:promote<span class="w"> </span>pkglist.json<span class="w"> </span>--from<span class="o">=</span>testing<span class="w"> </span>--to<span class="o">=</span>release<span class="w"> </span>--url<span class="o">=</span>https://&lt;url&gt;/artifactory<span class="w"> </span>--user<span class="o">=</span>&lt;user&gt;<span class="w"> </span>--password<span class="o">=</span>&lt;password&gt;
</pre></div>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">art:promote</span></code> command doesn’t work with ArtifactoryCE, Pro editions of Artifactory are needed.
The promote functionality can be implemented in these cases with a simple download+upload flow:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Promoting from testing-&gt;release</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Promotion using Conan download/upload commands</span>
<span class="c1"># (slow, can be improved with art:promote custom command)</span>
$<span class="w"> </span>conan<span class="w"> </span>download<span class="w"> </span>--list<span class="o">=</span>promote.json<span class="w"> </span>-r<span class="o">=</span>testing<span class="w"> </span>--format<span class="o">=</span>json<span class="w"> </span>&gt;<span class="w"> </span>downloaded.json
$<span class="w"> </span>conan<span class="w"> </span>upload<span class="w"> </span>--list<span class="o">=</span>downloaded.json<span class="w"> </span>-r<span class="o">=</span>release<span class="w"> </span>-c
</pre></div>
</div>
</div>
<p>After the promotion from 「testing」 to 「release」 repository, the packages would be like:</p>
<div align="center" class="align-center"><div class="graphviz"><object data="../_images/graphviz-0ddfc866b8c3d93bd7badd75f3aaf979b6998186.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph repositories {
    node [fillcolor=&quot;lightskyblue&quot;, style=filled, shape=box]
    rankdir=&quot;LR&quot;;
    subgraph cluster_0 {
        label=&quot;Packages server&quot;;
        style=filled;
        color=lightgrey;
        subgraph cluster_1 {
            label = &quot;testing\n repository&quot;
            shape = &quot;box&quot;;
            style=filled;
            color=lightblue;
            &quot;zlib/1.3.1&quot;;
            &quot;openssl/3.2.2&quot;;
        }

        subgraph cluster_2 {
            label = &quot;release\n repository&quot;
            shape = &quot;box&quot;;
            style=filled;
            color=lightblue;
            &quot;zlibpromoted&quot; [label=&quot;zlib/1.3.1&quot;];
            &quot;opensslpromoted&quot; [label=&quot;openssl/3.2.2&quot;];
        }
        {
            &quot;zlib/1.3.1&quot; -&gt; &quot;zlibpromoted&quot;;
            &quot;openssl/3.2.2&quot; -&gt; &quot;opensslpromoted&quot; [label=&quot;Promotion&quot;];
        }
    }
}</p></object></div>
</div>
<div class="admonition note">
<p class="admonition-title">備註</p>
<p><strong>最佳實踐</strong></p>
<ul class="simple">
<li><p>In modern package servers such as Artifactory package artifacts are <strong>deduplicated</strong>, that is, they do not
take any extra storage when they are copied in different locations, including different repositories.
The <strong>deduplication</strong> is checksum based, so the system is also smart to avoid re-uploading existing artifacts.
This is very important for the 「promotions」 mechanism: this mechanism is only copying some metadata, so
it can be very fast and it is storage efficient. Pipelines can define as many repositories and promotions
as necessary without concerns about storage costs.</p></li>
<li><p>Promotions can also be done in JFrog platform with <code class="docutils literal notranslate"><span class="pre">Release</span> <span class="pre">Bundles</span></code>. The <a class="reference external" href="https://github.com/conan-io/conan-extensions">Conan extensions repository</a>
also contains one command to generate a release bundle (that can be promoted using the Artifatory API).</p></li>
</ul>
</div>
<div class="admonition seealso">
<p class="admonition-title">也參考</p>
<ul class="simple">
<li><p><a class="reference internal" href="../examples/commands/pkglists.html#examples-commands-pkglists"><span class="std std-ref">Using package lists examples</span></a></p></li>
<li><p><a class="reference internal" href="../ci_tutorial/tutorial.html#ci-tutorial"><span class="std std-ref">Promotions usage in CI</span></a></p></li>
</ul>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vendoring.html" class="btn btn-neutral float-left" title="Vendoring dependencies in Conan packages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="audit.html" class="btn btn-neutral float-right" title="Checking package vulnerabilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最後更新於 10月 28, 2025。
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>