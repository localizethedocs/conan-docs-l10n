<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Copy sources from all your dependencies &mdash; conan 2.15.1 說明文件</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/examples/extensions/deployers/sources/custom_deployer_sources.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=25753662"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/translations.js?v=d9a6981e"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜尋" href="../../../../search.html" />
    <link rel="next" title="Conan recipe tools examples" href="../../../tools.html" />
    <link rel="prev" title="Custom deployers" href="../custom_deployers.html" />


 



</script>
<script type="text/javascript" src="../../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html">
            
              <img src="../../../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">簡介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ci_tutorial/tutorial.html">CI 教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devops/devops.html">開發運維指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../examples.html">範例</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../conanfile.html">ConanFile 方法範例</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../extensions.html">Conan extensions examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../commands/custom_commands.html">Custom commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../builtin_deployers.html">Builtin deployers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../custom_deployers.html">Custom deployers</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Copy sources from all your dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html">Conan recipe tools examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cross_build.html">Cross-building examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_files.html">組態檔範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../graph.html">Graph examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_flow.html">Developer tools and flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../commands.html">Conan 命令範例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../runners.html">Conan runners examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../incubating.html">孵化中的功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">變更日誌</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../examples.html">範例</a></li>
          <li class="breadcrumb-item"><a href="../../../extensions.html">Conan extensions examples</a></li>
          <li class="breadcrumb-item"><a href="../custom_deployers.html">Custom deployers</a></li>
      <li class="breadcrumb-item active">Copy sources from all your dependencies</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/extensions/deployers/sources/custom_deployer_sources.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="copy-sources-from-all-your-dependencies">
<h1>Copy sources from all your dependencies<a class="headerlink" href="#copy-sources-from-all-your-dependencies" title="Link to this heading">¶</a></h1>
<p>Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2 repository</a> in GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/examples/extensions/deployers/sources
</pre></div>
</div>
<p>In this example we are going to see how to create and use a custom deployer.
This deployer copies all the source files from your dependencies and puts them into a specific output folder</p>
<div class="admonition note">
<p class="admonition-title">備註</p>
<p>To better understand this example, it is highly recommended to have previously read the <a class="reference internal" href="../../../../reference/extensions/deployers.html#reference-extensions-deployer-direct-deploy"><span class="std std-ref">Deployers</span></a> reference.</p>
</div>
<section id="locate-the-deployer">
<h2>定位部署器<a class="headerlink" href="#locate-the-deployer" title="Link to this heading">¶</a></h2>
<p>In this case, the deployer is located in the same directory as our example conanfile,
but as shown in <a class="reference internal" href="../../../../reference/extensions/deployers.html#reference-extensions-deployer-direct-deploy"><span class="std std-ref">Deployers</span></a> reference,
Conan will look for the specified deployer in a few extra places in order, namely:</p>
<ol class="arabic simple">
<li><p>絕對路徑</p></li>
<li><p>Relative to cwd</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">[CONAN_HOME]/extensions/deployers</span></code> folder</p></li>
<li><p>Built-in deployers</p></li>
</ol>
</section>
<section id="run-it">
<h2>Run it<a class="headerlink" href="#run-it" title="Link to this heading">¶</a></h2>
<p>For our example, we have a simple recipe that lists both <code class="docutils literal notranslate"><span class="pre">zlib</span></code> and <code class="docutils literal notranslate"><span class="pre">mcap</span></code> as requirements.
With the help of the <code class="docutils literal notranslate"><span class="pre">tools.build:download_source=True</span></code> conf, we can force the invocation of its <code class="docutils literal notranslate"><span class="pre">source()</span></code> method,
which will ensure that sources are available even if no build needs to be carried out.</p>
<p>Now, you should be able to use the new deployer in both <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> and <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span></code> commands for any given recipe:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>info<span class="w"> </span>.<span class="w"> </span>-c<span class="w"> </span>tools.build:download_source<span class="o">=</span>True<span class="w"> </span>--deployer<span class="o">=</span>sources_deploy
</pre></div>
</div>
<p>Inspecting the command output we can see that it copied the sources of our direct dependencies <code class="docutils literal notranslate"><span class="pre">zlib</span></code> and <code class="docutils literal notranslate"><span class="pre">mcap</span></code>,
<strong>plus</strong> the sources of our transitive dependencies, <code class="docutils literal notranslate"><span class="pre">zstd</span></code> and <code class="docutils literal notranslate"><span class="pre">lz4</span></code> to a <code class="docutils literal notranslate"><span class="pre">dependencies_sources</span></code> folder.
After this is done, extra preprocessing could be done to accomplish more specific needs.</p>
<p>Note that you can pass the <code class="docutils literal notranslate"><span class="pre">--deployer-folder</span></code> argument to change the base folder output path for the deployer.</p>
</section>
<section id="code-tour">
<h2>Code tour<a class="headerlink" href="#code-tour" title="Link to this heading">¶</a></h2>
<p>The <strong>source_deploy.py</strong> file has the following code:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><strong>sources_deploy.py</strong></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>


<span class="k">def</span><span class="w"> </span><span class="nf">deploy</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Note the kwargs argument is mandatory to be robust against future changes.</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">conanfile</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">dep</span><span class="o">.</span><span class="n">folders</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dep</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">source_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConanException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sources missing for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> dependency.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                  <span class="s2">&quot;This deployer needs the sources of every dependency present to work, either building from source, &quot;</span>
                                  <span class="s2">&quot;or by using the &#39;tools.build:download_source&#39; conf.&quot;</span><span class="p">)</span>
        <span class="n">copy</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">conanfile</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">dep</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;dependency_sources&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dep</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<section id="deploy">
<h3>deploy()<a class="headerlink" href="#deploy" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">deploy()</span></code> method is called by Conan, and gets both a dependency graph and an output folder path as arguments.
It iterates all the dependencies of our recipe and copies every source file to their respective folders
under <code class="docutils literal notranslate"><span class="pre">dependencies_sources</span></code> using <a class="reference internal" href="../../../../reference/tools/files/basic.html#conan-tools-files-copy"><span class="std std-ref">conan.tools.copy</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">備註</p>
<p>If you’re using this deployer as an example for your own, remember that
<code class="docutils literal notranslate"><span class="pre">tools.build:download_source=True</span></code> is necessary so that <code class="docutils literal notranslate"><span class="pre">dep.folders.source_folder</span></code> is defined for the dependencies.
Without the conf, said variable will not be defined for those dependencies that do not need to be built from sources
nor in those commands that do not require building, such as <strong class="command">conan graph</strong>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">備註</p>
<p>If your custom deployer needs access to the full dependency graph, including those libraries that might be skipped,
use the <code class="docutils literal notranslate"><span class="pre">tools.graph:skip_binaries=False</span></code> conf. This is useful for collecting, for example, all the licenses in your graph.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../custom_deployers.html" class="btn btn-neutral float-left" title="Custom deployers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../tools.html" class="btn btn-neutral float-right" title="Conan recipe tools examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最後更新於 10月 28, 2025。
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>