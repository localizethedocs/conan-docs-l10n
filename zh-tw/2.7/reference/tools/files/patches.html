<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>conan.tools.files patches &mdash; conan 2.7.1 說明文件</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=2da93098" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/conan.css?v=7d9e9f1e" />

  
    <link rel="shortcut icon" href="../../../_static/conan-favicon.png"/>
    <link rel="canonical" href="https://projects.localizethedocs.org/conan-docs-l10n/reference/tools/files/patches.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=b9ab8571"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/translations.js?v=d9a6981e"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜尋" href="../../../search.html" />
    <link rel="next" title="conan.tools.files checksums" href="checksum.html" />
    <link rel="prev" title="conan.tools.files downloads" href="downloads.html" />


 



</script>
<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/conan-docs-logo-2.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">簡介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../whatsnew.html">What’s new in Conan 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devops.html">開發運維指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">範例</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../reference.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../commands.html">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../conanfile.html">conanfile.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../conanfile_txt.html">conanfile.txt</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tools.html">Recipe tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../android.html">conan.tools.android</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apple.html">conan.tools.apple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build.html">conan.tools.build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmake.html">conan.tools.cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp_info.html">conan.tools.CppInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../env.html">conan.tools.env</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../files.html">conan.tools.files</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="basic.html">conan.tools.files basic operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="downloads.html">conan.tools.files downloads</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">conan.tools.files patches</a></li>
<li class="toctree-l4"><a class="reference internal" href="checksum.html">conan.tools.files checksums</a></li>
<li class="toctree-l4"><a class="reference internal" href="symlinks.html">conan.tools.files.symlinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="packaging.html">conan.tools.files AutoPackager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../gnu.html">conan.tools.gnu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../google.html">conan.tools.google</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel.html">conan.tools.intel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../layout.html">conan.tools.layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../meson.html">conan.tools.meson</a></li>
<li class="toctree-l3"><a class="reference internal" href="../microsoft.html">conan.tools.microsoft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qbs.html">conan.tools.qbs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scm.html">conan.tools.scm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scons.html">conan.tools.scons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../system.html">conan.tools.system</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config_files.html">Configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extensions.html">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../environment.html">環境變數</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../binary_model.html">二進位模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../conan_server.html">Conan Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../runners.html">Runners</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">變更日誌</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">conan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../reference.html">Reference</a></li>
          <li class="breadcrumb-item"><a href="../../tools.html">Recipe tools</a></li>
          <li class="breadcrumb-item"><a href="../files.html">conan.tools.files</a></li>
      <li class="breadcrumb-item active">conan.tools.files patches</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/conan-io/docs/blob/develop2/reference/tools/files/patches.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="conan-tools-files-patches">
<h1>conan.tools.files patches<a class="headerlink" href="#conan-tools-files-patches" title="Link to this heading">¶</a></h1>
<section id="conan-tools-files-patch">
<span id="id1"></span><h2>conan.tools.files.patch()<a class="headerlink" href="#conan-tools-files-patch" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="conan.tools.files.patches.patch">
<span class="sig-name descname"><span class="pre">patch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conanfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_string</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fuzz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conan.tools.files.patches.patch" title="Link to this definition">¶</a></dt>
<dd><p>Applies a diff from file (patch_file) or string (patch_string) in the conanfile.source_folder
directory. The folder containing the sources can be customized with the self.folders attribute
in the layout(self) method.</p>
<dl class="field-list simple">
<dt class="field-odd">參數<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conanfile</strong> – the current recipe, always pass 『self』</p></li>
<li><p><strong>base_path</strong> – The path is a relative path to conanfile.export_sources_folder unless an
absolute path is provided.</p></li>
<li><p><strong>patch_file</strong> – Patch file that should be applied. The path is relative to the
conanfile.source_folder unless an absolute path is provided.</p></li>
<li><p><strong>patch_string</strong> – Patch string that should be applied.</p></li>
<li><p><strong>strip</strong> – Number of folders to be stripped from the path.</p></li>
<li><p><strong>fuzz</strong> – Should accept fuzzy patches.</p></li>
<li><p><strong>kwargs</strong> – Extra parameters that can be added and will contribute to output information</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>Usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conan_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;patches&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">it</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="conan-tools-files-apply-conandata-patches">
<span id="id2"></span><h2>conan.tools.files.apply_conandata_patches()<a class="headerlink" href="#conan-tools-files-apply-conandata-patches" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="conan.tools.files.patches.apply_conandata_patches">
<span class="sig-name descname"><span class="pre">apply_conandata_patches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conanfile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conan.tools.files.patches.apply_conandata_patches" title="Link to this definition">¶</a></dt>
<dd><p>Applies patches stored in <code class="docutils literal notranslate"><span class="pre">conanfile.conan_data</span></code> (read from <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code> file).
It will apply all the patches under <code class="docutils literal notranslate"><span class="pre">patches</span></code> entry that matches the given
<code class="docutils literal notranslate"><span class="pre">conanfile.version</span></code>. If versions are not defined in <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code> it will apply all the
patches directly under <code class="docutils literal notranslate"><span class="pre">patches</span></code> keyword.</p>
<p>The key entries will be passed as kwargs to the <code class="docutils literal notranslate"><span class="pre">patch</span></code> function.</p>
</dd></dl>

<p>Usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">apply_conandata_patches</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">apply_conandata_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Examples of <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">patches</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;patches/0001-buildflatbuffers-cmake.patch&quot;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;patches/0002-implicit-copy-constructor.patch&quot;</span>
<span class="w">  </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;subfolder&quot;</span>
<span class="w">  </span><span class="nt">patch_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backport</span>
<span class="w">  </span><span class="nt">patch_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/google/flatbuffers/pull/5650</span>
<span class="w">  </span><span class="nt">patch_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Needed to build with modern clang compilers.</span>
</pre></div>
</div>
<p>With different patches for different versions:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;1.11.0&quot;</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;patches/0001-buildflatbuffers-cmake.patch&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;patches/0002-implicit-copy-constructor.patch&quot;</span>
<span class="w">      </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;subfolder&quot;</span>
<span class="w">      </span><span class="nt">patch_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backport</span>
<span class="w">      </span><span class="nt">patch_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/google/flatbuffers/pull/5650</span>
<span class="w">      </span><span class="nt">patch_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Needed to build with modern clang compilers.</span>
<span class="w">  </span><span class="s">&quot;1.12.0&quot;</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;patches/0001-buildflatbuffers-cmake.patch&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_string</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">--- a/tests/misc-test.c</span>
<span class="w">        </span><span class="no">+++ b/tests/misc-test.c</span>
<span class="w">        </span><span class="no">@@ -1232,6 +1292,8 @@ main (int argc, char **argv)</span>
<span class="w">              </span><span class="no">g_test_add_func (&quot;/misc/pause-cancel&quot;, do_pause_cancel_test);</span>
<span class="w">              </span><span class="no">g_test_add_data_func (&quot;/misc/stealing/async&quot;, GINT_TO_POINTER (FALSE), do_stealing_test);</span>
<span class="w">              </span><span class="no">g_test_add_data_func (&quot;/misc/stealing/sync&quot;, GINT_TO_POINTER (TRUE), do_stealing_test);</span>
<span class="w">        </span><span class="no">+     g_test_add_func (&quot;/misc/response/informational/content-length&quot;, do_response_informational_content_length_test);</span>
<span class="w">        </span><span class="no">+</span>

<span class="w">        </span><span class="no">ret = g_test_run ();</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;patches/0003-fix-content-length-calculation.patch&quot;</span>
</pre></div>
</div>
<p>For each patch, a <code class="docutils literal notranslate"><span class="pre">patch_file</span></code>, a <code class="docutils literal notranslate"><span class="pre">patch_string</span></code> or a <code class="docutils literal notranslate"><span class="pre">patch_user</span></code> field must be provided. The first two are automatically applied by <code class="docutils literal notranslate"><span class="pre">apply_conandata_patches()</span></code>, while <code class="docutils literal notranslate"><span class="pre">patch_user</span></code> are ignored, and must be handled by the user directly in the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> recipe.</p>
</section>
<section id="conan-tools-files-export-conandata-patches">
<h2>conan.tools.files.export_conandata_patches()<a class="headerlink" href="#conan-tools-files-export-conandata-patches" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="conan.tools.files.patches.export_conandata_patches">
<span class="sig-name descname"><span class="pre">export_conandata_patches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conanfile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conan.tools.files.patches.export_conandata_patches" title="Link to this definition">¶</a></dt>
<dd><p>Exports patches stored in 『conanfile.conan_data』 (read from 『conandata.yml』 file). It will export
all the patches under 『patches』 entry that matches the given 『conanfile.version』. If versions are
not defined in 『conandata.yml』 it will export all the patches directly under 『patches』 keyword.</p>
</dd></dl>

<p>Example of <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code> without versions defined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">conan.tools.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">export_conandata_patches</span>
<span class="k">def</span><span class="w"> </span><span class="nf">export_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">export_conandata_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="downloads.html" class="btn btn-neutral float-left" title="conan.tools.files downloads" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="checksum.html" class="btn btn-neutral float-right" title="conan.tools.files checksums" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, JFrog.
      <span class="lastupdated">最後更新於 10月 28, 2025。
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>


 


</body>
</html>